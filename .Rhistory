# 3. Funkcija koja automatski izvlači Accuracy za svaki model
dobavi_accuracy <- function(model) {
# Predikcija (za logističku regresiju koristimo prag 0.5)
if(inherits(model, "glm")) {
p <- predict(model, newdata = test_bin, type = "response")
pred <- factor(ifelse(p > 0.5, "1", "0"), levels = levels(stvarni_podaci))
} else {
p <- predict(model, newdata = test_bin, type = "class")
pred <- factor(p, levels = levels(stvarni_podaci))
}
# Računanje matrice konfuzije
cm <- confusionMatrix(pred, stvarni_podaci)
return(cm$overall["Accuracy"])
}
# 4. Primeni funkciju na sve modele i napravi tabelu
tabela_rezultata <- data.frame(
Model = names(moji_modeli),
Accuracy = sapply(moji_modeli, dobavi_accuracy)
)
# 1. Osiguraj da su stvarni podaci faktor (ključno za matricu konfuzije)
stvarni_podaci <- as.factor(test_bin$Target_binary)
# 2. Napravi listu modela koje želiš u tabeli
moji_modeli <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg" = log_model,
"Random Forest" = rf_model,
"RF CV" = rf_cv_model,
"RF SMOTE" = rf_smote_model
)
# 3. Funkcija koja automatski izvlači Accuracy za svaki model
dobavi_accuracy <- function(model) {
# 1. Ako je model iz caret paketa (train objekat)
if(inherits(model, "train")) {
pred <- predict(model, newdata = test_bin, type = "raw")
}
# 2. Ako je logistička regresija (glm)
else if(inherits(model, "glm")) {
p <- predict(model, newdata = test_bin, type = "response")
pred <- ifelse(p > 0.5, "1", "0")
}
# 3. Ako je obično stablo (rpart ili tree)
else {
pred <- predict(model, newdata = test_bin, type = "class")
}
# Osiguraj da su predikcije faktor sa istim nivoima kao stvarni podaci
pred_factor <- factor(pred, levels = levels(stvarni_podaci))
# Računanje matrice i izvlačenje Accuracy
cm <- confusionMatrix(pred_factor, stvarni_podaci)
return(cm$overall["Accuracy"])
}
# Sada pokreni ponovo:
tabela_rezultata <- data.frame(
Model = names(moji_modeli),
Accuracy = sapply(moji_modeli, dobavi_accuracy)
)
print(tabela_rezultata)
y_true <- test_bin$Target_binary
y_true <- factor(y_true)
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
metrics <- lapply(models, function(model) {
preds <- predict(model, test_data)
preds <- factor(preds, levels = levels(y_true))
cm <- confusionMatrix(preds, y_true)
c(
Accuracy  = cm$overall["Accuracy"],
Precision = cm$byClass["Precision"],
Recall    = cm$byClass["Recall"],
F1        = cm$byClass["F1"]
)
})
y_true <- test_bin$Target_binary
y_true <- factor(y_true)
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
metrics <- lapply(models, function(model) {
preds <- predict(model, test_bin)
preds <- factor(preds, levels = levels(y_true))
cm <- confusionMatrix(preds, y_true)
c(
Accuracy  = cm$overall["Accuracy"],
Precision = cm$byClass["Precision"],
Recall    = cm$byClass["Recall"],
F1        = cm$byClass["F1"]
)
})
y_true <- test_bin$Target_binary
y_true <- factor(y_true)
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
dobavi_accuracy <- function(model) {
# 1. Ako je model iz caret paketa (train objekat)
if(inherits(model, "train")) {
pred <- predict(model, newdata = test_bin, type = "raw")
}
# 2. Ako je logistička regresija (glm)
else if(inherits(model, "glm")) {
p <- predict(model, newdata = test_bin, type = "response")
pred <- ifelse(p > 0.5, "1", "0")
}
# 3. Ako je obično stablo (rpart ili tree)
else {
pred <- predict(model, newdata = test_bin, type = "class")
}
# Osiguraj da su predikcije faktor sa istim nivoima kao stvarni podaci
pred_factor <- factor(pred, levels = levels(stvarni_podaci))
# Računanje matrice i izvlačenje Accuracy
cm <- confusionMatrix(pred_factor, stvarni_podaci)
return(cm$overall["Accuracy"])
}
# Sada pokreni ponovo:
tabela_rezultata <- data.frame(
Model = names(moji_modeli),
Accuracy = sapply(moji_modeli, dobavi_accuracy)
)
print(tabela_rezultata)
y_true <- test_bin$Target_binary
y_true <- factor(y_true)
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
metrics <- lapply(models, function(model) {
preds <- predict(model, test_bin)
preds <- factor(preds, levels = levels(y_true))
cm <- confusionMatrix(preds, y_true)
c(
Accuracy  = cm$overall["Accuracy"],
Precision = cm$byClass["Precision"],
Recall    = cm$byClass["Recall"],
F1        = cm$byClass["F1"]
)
})
# 1. Priprema ciljne varijable
y_true <- factor(test_bin$Target_binary)
# 2. Lista svih tvojih modela
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
# 3. Pametna funkcija za vađenje metrika
get_metrics <- function(model) {
# A) Predikcija na osnovu tipa modela
if (inherits(model, "train")) {
# Za modele iz caret-a (RF CV, SMOTE)
preds <- predict(model, newdata = test_bin, type = "raw")
} else if (inherits(model, "glm")) {
# Za logističku regresiju
prob <- predict(model, newdata = test_bin, type = "response")
preds <- ifelse(prob > 0.5, "1", "0")
} else {
# Za obična stabla (rpart/tree) i osnovni randomForest
preds <- predict(model, newdata = test_bin, type = "class")
}
# B) Standardizacija faktora
preds <- factor(preds, levels = levels(y_true))
# C) Izračunavanje matrice konfuzije
cm <- confusionMatrix(preds, y_true, positive = "1")
# D) Pakovanje rezultata
return(c(
Accuracy  = round(cm$overall["Accuracy"], 4),
Precision = round(cm$byClass["Precision"], 4),
Recall    = round(cm$byClass["Recall"], 4),
F1        = round(cm$byClass["F1"], 4)
))
}
# 4. Kreiranje finalne tabele
results_list <- lapply(models, get_metrics)
train_bin$Target_binary <- factor(train_bin$Target_binary)
test_bin$Target_binary  <- factor(test_bin$Target_binary)
# 1. Priprema ciljne varijable
y_true <- factor(test_bin$Target_binary)
# 2. Lista svih tvojih modela
models <- list(
"Decision Tree 1" = tree_model_bin,
"Decision Tree 2" = tree_model_bin2,
"Logistic Reg"    = log_model,
"Random Forest"   = rf_model,
"RF CV"           = rf_cv_model,
"RF SMOTE"        = rf_smote_model
)
# 3. Pametna funkcija za vađenje metrika
get_metrics <- function(model) {
# A) Predikcija na osnovu tipa modela
if (inherits(model, "train")) {
# Za modele iz caret-a (RF CV, SMOTE)
preds <- predict(model, newdata = test_bin, type = "raw")
} else if (inherits(model, "glm")) {
# Za logističku regresiju
prob <- predict(model, newdata = test_bin, type = "response")
preds <- ifelse(prob > 0.5, "1", "0")
} else {
# Za obična stabla (rpart/tree) i osnovni randomForest
preds <- predict(model, newdata = test_bin, type = "class")
}
# B) Standardizacija faktora
preds <- factor(preds, levels = levels(y_true))
# C) Izračunavanje matrice konfuzije
cm <- confusionMatrix(preds, y_true, positive = "1")
# D) Pakovanje rezultata
return(c(
Accuracy  = round(cm$overall["Accuracy"], 4),
Precision = round(cm$byClass["Precision"], 4),
Recall    = round(cm$byClass["Recall"], 4),
F1        = round(cm$byClass["F1"], 4)
))
}
# 4. Kreiranje finalne tabele
results_list <- lapply(models, get_metrics)
train_bin$Target_binary <- factor(train_bin$Target_binary, labels = c("Class0", "Class1"))
test_bin$Target_binary <- factor(test_bin$Target_binary, labels = c("Class0", "Class1"))
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = TRUE,
summaryFunction = multiClassSummary
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1" # Tells caret to optimize for F1 score
)
mean_metrics <- rf_cv_model$results
cat("Mean Accuracy across 5 folds:", mean_metrics$Accuracy[2], "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F1[2], "\n")
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = "Class1")
test_bin$Target_binary
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = prSummary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F"                # Caret u prSummary F1-score naziva samo "F"
)
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = prSummary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
# metric = "F"                # Caret u prSummary F1-score naziva samo "F"
)
f1_acc_summary <- function(data, lev = NULL, model = NULL) {
# Kreiranje matrice konfuzije iz predviđenih i stvarnih klasa
cm <- confusionMatrix(data$pred, data$obs, positive = lev[2]) # lev[2] je obično "1"
# Vađenje metrika
acc <- cm$overall["Accuracy"]
f1  <- cm$byClass["F1"]
out <- c(f1, acc)
names(out) <- c("F1", "Accuracy")
return(out)
}
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = f1_acc_summary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1"                # Caret u prSummary F1-score naziva samo "F"
)
# 3. Izvlačenje metrika (uzimamo najbolji red rezultata)
mean_metrics <- rf_cv_model$results[which.max(rf_cv_model$results$F), ]
cat("Mean Recall across 5 folds:", mean_metrics$Recall, "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F, "\n")
# 4. Finalni model i evaluacija
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = "Class1")
dataset$Target = factor(dataset$Target)
dataset$Sex = factor(dataset$Sex)
dataset$Target_binary <- ifelse(dataset$Target == "Blood Donor", 0, 1)
dataset$Target_binary
f1_acc_summary <- function(data, lev = NULL, model = NULL) {
# Kreiranje matrice konfuzije iz predviđenih i stvarnih klasa
cm <- confusionMatrix(data$pred, data$obs, positive = lev[2]) # lev[2] je obično "1"
# Vađenje metrika
acc <- cm$overall["Accuracy"]
f1  <- cm$byClass["F1"]
out <- c(f1, acc)
names(out) <- c("F1", "Accuracy")
return(out)
}
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = f1_acc_summary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1"                # Caret u prSummary F1-score naziva samo "F"
)
# 3. Izvlačenje metrika (uzimamo najbolji red rezultata)
mean_metrics <- rf_cv_model$results[which.max(rf_cv_model$results$F), ]
cat("Mean Recall across 5 folds:", mean_metrics$Recall, "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F, "\n")
# 4. Finalni model i evaluacija
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = 1)
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = f1_acc_summary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1"                # Caret u prSummary F1-score naziva samo "F"
)
# 3. Izvlačenje metrika (uzimamo najbolji red rezultata)
mean_metrics <- rf_cv_model$results[which.max(rf_cv_model$results$F), ]
cat("Mean Recall across 5 folds:", mean_metrics$Recall, "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F, "\n")
# 4. Finalni model i evaluacija
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = "1")
f1_acc_summary <- function(data, lev = NULL, model = NULL) {
# Kreiranje matrice konfuzije iz predviđenih i stvarnih klasa
cm <- confusionMatrix(data$pred, data$obs, positive = lev[2]) # lev[2] je obično "1"
# Vađenje metrika
acc <- cm$overall["Accuracy"]
f1  <- cm$byClass["F1"]
out <- c(f1, acc)
names(out) <- c("F1", "Accuracy")
return(out)
}
train_bin$Target_binary <- as.factor(train_bin$Target_binary)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = FALSE,          # SADA MOŽE BITI FALSE
summaryFunction = f1_acc_summary  # KORISTIMO prSummary za Precision, Recall i F1
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1"                # Caret u prSummary F1-score naziva samo "F"
)
# 3. Izvlačenje metrika (uzimamo najbolji red rezultata)
mean_metrics <- rf_cv_model$results[which.max(rf_cv_model$results$F), ]
cat("Mean Recall across 5 folds:", mean_metrics$Recall, "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F, "\n")
# 4. Finalni model i evaluacija
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = "1")
train_bin$Target_binary <- factor(train_bin$Target_binary, labels = c("Class0", "Class1"))
test_bin$Target_binary <- factor(test_bin$Target_binary, labels = c("Class0", "Class1"))
train_control <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = TRUE,
summaryFunction = multiClassSummary
)
set.seed(123)
rf_cv_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control,
metric = "F1" # Tells caret to optimize for F1 score
)
mean_metrics <- rf_cv_model$results
cat("Mean Accuracy across 5 folds:", mean_metrics$Accuracy[2], "\n")
cat("Mean F1-score across 5 folds:", mean_metrics$F1[2], "\n")
print(rf_cv_model)
varImpPlot(rf_cv_model$finalModel, main = "Značajnost parametara (5-Fold CV)")
predictions <- predict(rf_cv_model, newdata = test_bin)
confusionMatrix(predictions, test_bin$Target_binary, positive = "Class1")
train_control_smote <- trainControl(
method = "cv",
number = 5,
savePredictions = "final",
classProbs = TRUE,
summaryFunction = multiClassSummary,
sampling = "smote"
)
set.seed(123)
rf_smote_model <- train(
Target_binary ~ AST + ALT + GGT + BIL + ALP + ALB + CHOL + CHE + CREA + Age + Sex,
data = train_bin,
method = "rf",
ntree = 50,
trControl = train_control_smote,
metric = "F1" # Optimizujemo prema F1 jer su klase nebalansirane
)
# Provera rezultata
print(rf_smote_model)
# Evaluacija na test setu
predictions_smote <- predict(rf_smote_model, newdata = test_bin)
confusionMatrix(predictions_smote, test_bin$Target_binary, positive = "Class1")
# Instaliraj ako nemaš:
# install.packages("modelsummary")
library(modelsummary)
# Napravi listu svojih modela (možeš im dati i lepša imena)
moji_modeli <- list(
"Stablo 1" = tree_model_bin,
"Stablo 2" = tree_model_bin2,
"Logistička" = log_model,
"Random Forest" = rf_model,
)
# Instaliraj ako nemaš:
# install.packages("modelsummary")
library(modelsummary)
# Napravi listu svojih modela (možeš im dati i lepša imena)
moji_modeli <- list(
"Stablo 1" = tree_model_bin,
"Stablo 2" = tree_model_bin2,
"Logistička" = log_model,
"Random Forest" = rf_model
)
# Prikupi sve u jednu tabelu
modelsummary(moji_modeli,
output = "markdown", # ili "text" za konzolu
stars = TRUE,        # dodaje zvezdice za značajnost
title = "Poređenje performansi modela")
