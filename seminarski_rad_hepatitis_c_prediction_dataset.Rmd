---
title: "Seminarski rad - Hepatitis C Prediction Dataset"
output:
  html_document: default
  word_document: default
date: "2025-12-15"
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Tema: Hepatitis C Naziv: hepatitis-c-dataset.csv

Hepatitis C Prediction Dataset je skup podataka koji pruža detaljan uvid u laboratorijske nalaze krvi i osnovne demografske karakteristike pacijenata, sa ciljem analize zdravlja jetre.
Podaci obuhvataju biohemijske parametre jetre, kao što su ALT, AST, GGT, bilirubin i albumin, koji su značajni indikatori oštećenja i funkcije jetre.
Ciljna promenljiva Category označava zdravstveni status pacijenata, uključujući zdrave davaoce krvi i različite stadijume oboljenja od Hepatitisa C (hepatitis, fibroza i ciroza).
Podaci uključuju kliničke pokazatelje i demografske informacije, a prikupljeni su radi omogućavanja analize i izgradnje modela klasifikacije za razlikovanje zdravih i obolelih pacijenata.

Link ka skupu podataka na kaggle sajtu: <https://www.kaggle.com/datasets/fedesoriano/hepatitis-c-dataset>

# Prikaz podataka

Učitavanje potrebnih biblioteka

```{r}
library(tidyverse)
library(Amelia)
library(nortest)
library(ggplot2)
library(corrplot)
library(rpart)
library(rpart.plot)
library(randomForest)
library(caret)
library(pROC) #za upoređivanje razlicitih modela kod predikcije
```

## Učitavanje skupa podataka

```{r}
dataset = read.csv("HepatitisCdata.csv", sep=",")
# dataset = read.csv("C:/Users/Teodora/Desktop/seminarski/HepatitisCdata.csv", sep=",")
View(dataset)
```

Funkcija head prikazuje prvih šest redova dataset-a i tako se upoznajemo sa podacima.

```{r}
head(dataset)
```

Funkcije ncol i nrow daju informacije o dimenzijama(broju kolona i broju redova) skupa podataka.
Skup podataka ima 14 kolona i 615 redova.

```{r}
ncol(dataset)
nrow(dataset)
```

Funkcija str nam daje strukturu skupa podataka.
Prikazuje tip podatka za svaku promenljivu, kao i prvih nekoliko vrednosti u svakoj koloni.
U skupu podataka se nalazi 12 numeričkih promenljivih(int, num) i 2 kategorijske promenljive(chr).

```{r}
str(dataset)
```

Skup podataka sadrži sledeće kolone:

1.  X – numerička promenljiva koja označava jedinstveni identifikacioni broj pacijenta
2.  Category – kategorijska promenljiva koja označava zdravstveni status pacijenta (0 – davalac krvi, 0s – sumnjivi davalac krvi, 1 – Hepatitis, 2 – Fibroza, 3 – Ciroza)
3.  Age – numerička promenljiva koja označava starost pacijenta u godinama
4.  Sex – kategorijska promenljiva koja označava pol pacijenta (m – muški, f – ženski)
5.  ALB – numerička promenljiva koja označava koncentraciju albumina u krvi
6.  ALP – numerička promenljiva koja označava nivo alkalne fosfataze u krvi
7.  ALT – numerička promenljiva koja označava nivo alanin-aminotransferaze u krvi
8.  AST – numerička promenljiva koja označava nivo aspartat-aminotransferaze u krvi
9.  BIL – numerička promenljiva koja označava nivo bilirubina u krvi
10. CHE – numerička promenljiva koja označava nivo holinesteraze u krvi
11. CHOL – numerička promenljiva koja označava nivo holesterola u krvi
12. CREA – numerička promenljiva koja označava nivo kreatinina u krvi
13. GGT – numerička promenljiva koja označava nivo gama-glutamil transferaze u krvi
14. PROT – numerička promenljiva koja označava ukupnu koncentraciju proteina u krvi

# Priprema podataka

## Nedostajuće vrednosti

Funkcija summary daje uvid u raspodelu podataka i može ukazati na nedostajuće vrednosti.

```{r}
summary(dataset)
```

Nedostajuće vrednosti po kolonama možemo prikazati kombinacijom funkcija is.na i colSums

```{r}
colSums(is.na(dataset))
```

Vidimo da ovaj skup podataka ima nedostajuće vrednosti u 5 numeričkih kolona i to su: ALB, ALP, ALT, CHOL i PROT.
Ove podatke je potrebno pripremiti za dalju analizu.

```{r}
colMeans(is.na(dataset))*100
```

```{r}
par(mfrow=c(1,1))
missmap(obj = dataset, main = "Hepatitis C dataset")
```

Ovo je procentualni prikaz nedostajućih vrednosti i vidimo da one čine mali procenat ukupnih podataka.

### Analiza i obrada nedostajućih vrednosti u numeričkim kolonama

Nedostojeće vrednosti kolone ALB

```{r}
sum(is.na(dataset$ALB))
```

U ovoj koloni imamo 1 podatak koji nedostaje.
Pošto podatke uvek bolje sačuvati nego obrisati, a u ovom slučaju imamo samo jedan podatak koji nedostaje, možemo upotrebiti metodu umetanja vrednosti kao npr.
mean ili median.
Izbor metode zavisi od distribucije podataka, zato moramo da proverimo kakva je distribucija podataka u ovoj koloni.
Shapiro-Wilk test koji smo ranije koristili je ograničen na 3-5000 podataka, što znači da možemo da upotrebimo na ovom koji ima 615 podataka.

```{r}
shapiro.test(dataset$ALB[!is.na(dataset$ALB)])
```

Na osnovu rezultata Shapiro–Wilk testa, odnosno veoma niske p-vrednosti možemo videti da raspodela vrednosti u koloni ALB značajno odstupa od normalne.
To nam ukazuje na prisustvo asimetrije i/ili ekstremnih vrednosti u podacima.
U takvoj situaciji aritmetička sredina može biti pod snažnim uticajem tih odstupanja i ne predstavlja tipičan rezultat, dok je medijana otpornija na ekstremne vrednosti i pruža realniji prikaz tipične vrednosti u skupu podataka, pa je pogodniji izbor za popunjavanje nedostajuće vrednosti.

```{r}
dataset$ALB[is.na(dataset$ALB)] <- median(dataset$ALB, na.rm = TRUE)

sum(is.na(dataset$ALB)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone ALP

```{r}
sum(is.na(dataset$ALP))
```

U ovoj koloni imamo 18 podataka koji nedostaju.
Ponovo koristimo Shapiro–Wilk test za proveru normalnosti kako bismo odredili koja vrednost je najpogodnija za umetanje.

```{r}
shapiro.test(dataset$ALP[!is.na(dataset$ALP)])
```

Na osnovu rezultata Shapiro–Wilk testa može se videti da je dobijena vrlo mala p-vrednost (p = 3.467e-16), što ukazuje na to da se raspodela vrednosti u koloni ALP značajno razlikuje od normalne.
To sugeriše prisustvo asimetrije ili ekstremnih vrednosti u podacima, zbog čega aritmetička sredina nije pouzdan izbor.
Medijana predstavlja stabilniju meru centralne tendencije i pogodnija je za imputaciju nedostajućih vrednosti u ovom slučaju.

```{r}
dataset$ALP[is.na(dataset$ALP)] <- median(dataset$ALP, na.rm = TRUE)

sum(is.na(dataset$ALP)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone ALT

```{r}
sum(is.na(dataset$ALT))
```

Pošto i u ovoj koloni postoji 1 nedostajući podatak, potrebno je proveriti kakva je raspodela vrednosti, kako bi se izabrala najprikladnija vrednost za umetanje.

```{r}
shapiro.test(dataset$ALT[!is.na(dataset$ALT)])
```

Na osnovu rezultata Shapiro–Wilk testa, možemo videti da raspodela vrednosti u koloni ALt značajno odstupa od normalne, što pokazuje veoma mala p-vrednost.
Ovakav rezultat ukazuje na prisustvo asimetrije i/ili ekstremnih vrednosti u podacima.
Dakle aritmetička sredina može biti pod snažnim uticajem tih odstupanja i ne predstavlja tipičan rezultat, dok je medijana otpornija na ekstremne vrednosti i pruža realniji prikaz tipične vrednosti u skupu podataka, pa je pogodniji izbor za popunjavanje nedostajuće vrednosti.

```{r}
dataset$ALT[is.na(dataset$ALT)] <- median(dataset$ALT, na.rm = TRUE)

sum(is.na(dataset$ALT)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone CHOL

```{r}
sum(is.na(dataset$CHOL))
```

U koloni CHOL prisutno je 10 nedostajućih vrednosti.
Pre nego što odaberemo način popunjavanja, potrebno je proveriti raspodelu podataka kako bismo izabrali najpogodniju meru centralne tendencije.

```{r}
shapiro.test(dataset$CHOL[!is.na(dataset$CHOL)])
```

Na osnovu rezultata Shapiro–Wilk testa može se videti da je p-vrednost vrlo mala (p = 0.0003), što znači da raspodela vrednosti u koloni CHOL nije normalna.
Iako je W prilično blizu 1, statistički značajno odstupanje sugeriše blagu asimetriju ili prisustvo ekstremnih vrednosti.
Zbog toga aritmetička sredina može biti pod uticajem tih vrednosti, pa je medijana stabilniji i pouzdaniji izbor za popunjavanje nedostajućih podataka.

```{r}
dataset$CHOL[is.na(dataset$CHOL)] <- median(dataset$CHOL, na.rm = TRUE)

sum(is.na(dataset$CHOL)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone PROT

```{r}
sum(is.na(dataset$PROT))
```

Takodje, i u koloni PROT prisutna je samo 1 nedostojeća vrednost.
Potrebno je proveriti kakva je raspodela vrednosti, kako bi se izabrala najprikladnija vrednost za umetanje.

```{r}
shapiro.test(dataset$PROT[!is.na(dataset$PROT)])
```

Za kolonu PROT takođe je primenjen Shapiro–Wilk test, čiji rezultati ukazuju na značajno odstupanje od normalne raspodele (veoma mala p-vrednost).
Kao i u prethodnim slučajevima, zbog ovakve raspodele podataka i prisustva mogućih ekstremnih vrednosti, medijana je stabilniji i pouzdaniji izbor za popunjavanje nedostajućih podataka.

```{r}
dataset$PROT[is.na(dataset$PROT)] <- median(dataset$PROT, na.rm = TRUE)
```

```{r}

sum(is.na(dataset$PROT)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

### Analiza i obrada nedostajućih vrednosti u kategorijskim kolonama

Proverićemo prisustvo nedostajućih vrednosti u kategorijskim kolonama Category i Sex.
Prvo ćemo koristiti frekvencijske tabele kako bismo identifikovali sve postojeće kategorije i proverili da li se pojavljuju neke neočekivane ili pogrešne vrednosti.
Zatim ćemo proveriti postojanje eksplicitnih NA vrednosti i praznih stringova.

```{r}
table(dataset$Category)
```

```{r}
sum(is.na(dataset$Category) | dataset$Category == "")
```

```{r}
table(dataset$Sex)
```

```{r}
sum(is.na(dataset$Sex) | dataset$Sex == "")
```

Na osnovu ovoga vidimo da u kolonama Category i Sex ne postoje neočekivane kategorije, NA vrednosti niti prazna polja.

## Analiza raspodele podataka po kolonama

Analiza raspodele promenljivih prikazuje kako su podaci rasporedjeni u okviru svake kolone, omogućava uočavanje obrazaca u podacima, identifikuje da li postoje izuzeci itd.
Za proveru postojanja izuzetaka(outlier-a) koristićemo jedan od jednostavnih pristupa,a to je IQR metoda.
Glavna prednost ovog pristupa je u tome što se ne oslanja na aritmetičku sredinu, koja je izrazito osetljiva na ekstremne vrednosti, već na kvartile koji su znatno stabilniji.
Metoda podrazumeva izračunavanje prvog (Q1) i trećeg kvartila (Q3), na osnovu kojih se određuju donja i gornja granica (Q1 - 1.5 \* IQR i Q3 + 1.5 \* IQR).
Vrednosti koje odstupaju od ovih granica klasifikuju se kao izuzeci.
Istovremeno, možemo napraviti boxplot za svaku kolonu kako bismo vizuelno prikazali ekstrema i lakše identifikovali outlajere.


**Kolona Age**

```{r}
summary(dataset$Age)
```

Starost pacijenata je u rasponu od 19 do 77 godina.
Srednja vrednost iznosi 47.41, dok je medijana 47, što ukazuje na približno simetričnu raspodelu.
Većina pacijenata nalazi se u srednjim starosnim kategorijama.

Grafički prikaz raspodele pacijenata u odnosu na broj godina

Histogram raspodele pacijenata po godinama

```{r}
ggplot(dataset, aes(x = Age)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele godina")
```

Na osnovu grafika vidimo da je najveći broj pacijenata starosti između 35 i 55 godina.
Raspodela je relativno ravnomerna, sa blagim asimetrijom, ali bez ekstremnih odstupanja.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$Age, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$Age, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$Age[dataset$Age < donja_granica | dataset$Age > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu Age vidimo da je donji kvartil 16.5, gornji kvartil 76.5, a pomoću IQR metode identifikovan je jedan outlajer.
To znači da postoji jedna vrednost koja odstupa od ostatka uzorka (77 godina), ali pošto nije jako ekstremna, njen uticaj na statistiku je mali i može se bez problema ostaviti u analizi.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$Age, main = "Boxplot za Age", horizontal = TRUE)
```

Na boxplotu mozemo tacno videti taj jedan outlajer koji se nalazi iznad 76.5.

**Kolona Sex**

Pošto je Sex kategorijska kolona prikazaćemo tabelu učestalosti da bismo videli koliko puta se svaka kategorija pojavljuje.

```{r}
table(dataset$Sex)
```

Grafički prikaz raspodele polova

```{r}
ggplot(dataset, aes(x = Sex)) +
  geom_bar() +
  labs(title = "Raspodela polova u datasetu")
```

Na osnovu tabele učestalosti i grafika vidimo da u skupu podataka ima više pacijenata muškog pola.

**Kolona ALB**

```{r}
summary(dataset$ALB)
```

Vrednosti parametra ALB su u rasponu od 14.9 do 82.2.
Srednja vrednost iznosi 41.62, dok je medijana 41.95, što ukazuje na približno simetričnu raspodelu bez izražene asimetrije.
Većina pacijenata ima vrednosti ALB koncentrisane oko srednjih vrednosti.

Grafički prikaz raspodele pacijenata u odnosu na ALB

```{r}
ggplot(dataset, aes(x = ALB)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALB")
```

Na osnovu grafika vidimo da je najveći broj pacijenata ima vrednost ALB u opsegu između 35 i 50.
Raspodela je relativno simetrična, uz prisustvo nekoliko ekstremnih vrednosti, što može ukazivati na potencijalne outlajere u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALB, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALB, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALB[dataset$ALB < donja_granica | dataset$ALB > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALB donji kvartil je 29.2, a gornji kvartil 54.8.
IQR metodom identifikovano je 27 outlajera, što ukazuje na veću varijabilnost podataka.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALB, main = "Boxplot za ALB", horizontal = TRUE)
```

I boxplot za kolonu ALB vizuelno potvrđuje prisustvo većeg broja outliera, koji su najizraženiji na donjem kraju raspodele, dok se nekoliko ekstremnih vrednosti uočava i na gornjem kraju.
S obzirom da se radi o kliničkom parametru, ove vrednosti najverovatnije predstavljaju stvarna odstupanja povezana sa zdravstvenim stanjem pacijenata, a ne greške u merenju.
Zbog toga outlajeri nećemo uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona ALP**

```{r}
summary(dataset$ALP)
```

Vrednosti parametra ALP su u rasponu od 11.30 do 416.60.
Srednja vrednost iznosi 66.20, dok je medijana 68.22, što ukazuje na relativno simetričnu raspodelu centralnog dela podataka, uz prisustvo blage desne asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na ALP

```{r}
ggplot(dataset, aes(x = ALP)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALP")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost ALP u opsegu između 50 i 100.
Raspodela ima izražen rep ka višim vrednostima, uz prisustvo nekoliko veoma visokih vrednosti, što ukazuje prisustvo outlajera u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALP, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALP, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALP[dataset$ALP < donja_granica | dataset$ALP > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALP donji kvartil iznosi 13.425, dok je gornji kvartil 118.825.
Primenom IQR metode identifikovano je ukupno 14 outlajera.
To ukazuje na postojanje vrednosti koje odstupaju od većine podataka, ali njihov broj nije izrazito velik u odnosu na ukupan uzorak.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALP, main = "Boxplot za ALP", horizontal = TRUE)
```

Boxplot za ALP ukazuje na desno asimetričnu raspodelu sa nekoliko visokih outlajera.
S obzirom da je ALP biohemijski parametar, ove ekstremne vrednosti mogu predstavljati realna klinička odstupanja, a ne greške u merenju, iz tog razloga outlajere nećemo uklonjeni iz dalje analize.

**Kolona ALT**

```{r}
summary(dataset$ALT)
```

Vrednosti parametra ALT su u rasponu od 0.90 do 325.30.
Srednja vrednost iznosi 28.44, dok je medijana 23.00.
Srednja vrednost je primetno veća od medijane, pa možemo zaključiti da raspodela pokazuje izrazitu desnu asimetriju.

Grafički prikaz raspodele pacijenata u odnosu na ALT

```{r}
ggplot(dataset, aes(x = ALT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALT")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost ALT u opsegu između 15 i 40.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje prisustvo značajnih outlajera u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALT[dataset$ALT < donja_granica | dataset$ALT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALT donja granica za detekciju outlajera iznosi −8.575, dok je gornja granica 58.025.
Primenom IQR metode identifikovano je ukupno 36 gornjih outlajera, dok donjih nema.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALT, main = "Boxplot za ALT", horizontal = TRUE)
```

I boxplot za kolonu ALT vizuelno potvrđuje prisustvo Velikog broja gornjih outlajera, koji ukazuju na izraženu desnu asimetriju.
S obzirom da se radi o ključnom markeru oštećenja jetre, ove vrednosti najverovatnije predstavljaju realna patološka stanja kod pacijenata sa oštećenjem jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona AST**

```{r}
summary(dataset$AST)
```

Vrednosti parametra AST su u rasponu od 10.60 do 324.00.
Srednja vrednost iznosi 34.79, dok je medijana 25.90.
Znatna razlika između srednje vrednosti i medijane ukazuje na to da je raspodela izrazito asimetrična udesno.

Grafički prikaz raspodele pacijenata u odnosu na AST

```{r}
ggplot(dataset, aes(x = AST)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele AST")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost AST u opsegu između 20 i 40.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje prisustvo brojnih outlajera koji prelaze vrednost od 100, dok ekstremni slučajevi dostižu i preko 300.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$AST, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$AST, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$AST[dataset$AST < donja_granica | dataset$AST > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu AST, donji kvartil iznosi 4.65, a gornji kvartil 49.85.
Primenom IQR metode identifikovano je ukupno 64 outlajera, što ukazuje na postojanje vrednosti koje odstupaju od većine podataka.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$AST, main = "Boxplot za AST", horizontal = TRUE)
```

I boxplot za kolonu AST vizuelno potvrđuje prisustvo Velikog broja gornjih outlajera, koji ukazuju na izraženu desnu asimetriju.
S obzirom da je AST važan biohemijski marker oštećenja jetre, ove povišene vrednosti predstavljaju realna patološka stanja kod pacijenata sa oštećenjem jetre.
Zbog toga outlajeri neće biti uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona BIL**

```{r}
summary(dataset$BIL)
```

Vrednosti parametra BIL su u rasponu od 0.8 do 254.00.
Srednja vrednost iznosi 11.4, dok je medijana 7.3, što ukazuje na to da je raspodela asimetrična udesno, jer je srednja vrednost veća od medijane.

Grafički prikaz raspodele pacijenata u odnosu na BIL

```{r}
ggplot(dataset, aes(x = BIL)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele BIL")
```

Na osnovu dijagama vidimo da najveći broj pacijenata ima niske vrednosti BIL, u opsegu između 5 i 15.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo outlajera.
Manji broj pacijenata ima veoma povišene vrednosti bilirubina koje prelaze 100, dok ekstremni slučajevi dostižu i preko 200, što je tipično za teška oštećenja funkcije jetre.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$BIL, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$BIL, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$BIL[dataset$BIL < donja_granica | dataset$BIL > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu BIL, donji kvartil iznosi -3.55, a gornji 20.05.
Primenom IQR metode identifikovano je ukupno 47 outlajera.
Ova visoka broj outlajera ukazuje na značajne varijacije u nivoima bilirubina kod pacijenata.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$BIL, main = "Boxplot za BIL", horizontal = TRUE)
```

Boxplot za kolonu BIL ukazuje na desno asimetričnu raspodelu sa značajnim brojem gornjih outlajera.
Ovo potvrđuje prisustvo pacijenata sa značajno povišenim nivoima bilirubina.
S obzirom da je bilirubin ključni indikator jetrenih funkcija, ova odstupanja od normalnih vrednosti mogu biti posledica različitih oboljenja jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CHE**

```{r}
summary(dataset$CHE)
```

Vrednosti parametra CHE su u rasponu od 1.420 do 16.410.
Srednja vrednost iznosi 8.197, dok je medijana 8.260, što ukazuje da je raspodela približno simetrična, bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na CHE

```{r}
ggplot(dataset, aes(x = CHE)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CHE")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti CHE u opsegu između 6 i 10.
Možemo uočiti i potencijalne outlajere na nižim i višim vrednostima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CHE, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CHE, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CHE[dataset$CHE < donja_granica | dataset$CHE > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CHE, donji kvartil iznosi 2.95, dok gornji kvartil iznosi 13.57.
Primenom IQR metode identifikovana su ukupno 24 outliera, što ukazuje na prisustvo značajne varijabilnosti u nivoima holinesteraze među pacijentima.
S obzirom na to da je holinesteraza važan biohemijski marker funkcije jetre, odstupanja od normalnih vrednosti mogu biti posledica različitih oboljenja jetre.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CHE, main = "Boxplot za CHE", horizontal = TRUE)
```

Boxplot za kolonu CHE ukazuje na raspodelu sa izraženim outlierima na obe strane, što potvrđuje prisustvo pacijenata sa ekstremno sniženim i ekstremno povišenim vrednostima ovog enzima, što može biti posledica različitih oboljenja jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CHOL**

```{r}
summary(dataset$CHOL)
```

Vrednosti parametra CHOL su u rasponu od 1.430 do 9.670.
Srednja vrednost iznosi 5.367, dok je medijana 5.300, što ukazuje da je raspodela približno simetrična, bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na CHOL

```{r}
ggplot(dataset, aes(x = CHOL)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CHOL")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti CHE u opsegu otprilike između 4,5 i 6.
Možemo uočiti i potencijalne outlajere na nižim i višim vrednostima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CHOL, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CHOL, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CHOL[dataset$CHOL < donja_granica | dataset$CHOL > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CHOL, donji kvartil iznosi 2.46, dok gornji kvartil iznosi 8.21.
Primenom IQR metode identifikovana su ukupno 12 outliera, što ukazuje na prisustvo varijabilnosti u nivoima holesterola među pacijentima.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CHOL, main = "Boxplot za CHOL", horizontal = TRUE)
```

Boxplot za kolonu CHOL ukazuje na raspodelu sa izraženim outlierima na obe strane, što potvrđuje prisustvo pacijenata sa ekstremno sniženim i ekstremno povišenim vrednostima holesterola.
S obzirom na to da je holesterol bitan medicinski podatak koji zavisi od ishrane, genetike i opšteg zdravlja, ovakva odstupanja su sasvim normalna, izbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CREA**

```{r}
summary(dataset$CREA)
```

Vrednosti parametra CREA su u rasponu od 8.00 do 1079.10.
Srednja vrednost iznosi 81.29, dok je medijana 77.00, što ukazuje na asimetričnu raspodelu udesno, jer je srednja vrednost veća od medijane.

Grafički prikaz raspodele pacijenata u odnosu na CREA

```{r}
ggplot(dataset, aes(x = CREA)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CREA")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti kreatinina u opsegu otprilike između 60 i 100.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo izraženih outliera.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CREA, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CREA, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CREA[dataset$CREA < donja_granica | dataset$CREA > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CREA, donji kvartil (Q1) iznosi 35.5, a gornji (Q3) 119.5.
Primenom IQR metode identifikovano je ukupno 12 outlajera.
Prisutne su vrednosti koje drastično odskaču od proseka (poput 519.0 i 1079.1), što ukazuje na pacijente sa ozbiljno narušenom funkcijom bubreg.
Ovo je važno jer ozbiljna oboljenja jetre često dovode i do prestanka rada bubrega.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CREA, main = "Boxplot za CREA", horizontal = TRUE)
```

Boxplot za kolonu CREA ukazuje na desno asimetričnu raspodelu sa izraženim gornjim outlajerima.
Vizuelni prikaz potvrđuje da se većina vrednosti nalazi u nižem opsegu, dok mali broj ekstremno visokih vrednosti značajno odstupa.
Zbog prethodno navedenih razloga outlajeri neće biti uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona GGT**

```{r}
summary(dataset$GGT)
```

Vrednosti parametra GGT su u rasponu od 4.50 do 650.90.
Srednja vrednost iznosi 39.53, dok je medijana 23.30, što ukazuje na izraženu desnu asimetriju raspodele.
Većina pacijenata ima niske vrednosti GGT, koncentrisane u donjem delu raspodele, dok manji broj pacijenata ima veoma visoke vrednosti, koje značajno utiču na povećanje srednje vrednosti.

Grafički prikaz raspodele pacijenata u odnosu na GGT

```{r}
ggplot(dataset, aes(x = GGT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele GGT")
```

Na osnovu grafika vidimo da je najveći broj pacijenata ima niže vrednosti GGT.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo izraženih outliera.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$GGT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$GGT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$GGT[dataset$GGT < donja_granica | dataset$GGT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu GGT, donji kvartil iznosi -21.05, a gornji 76.95.
Primenom IQR metode identifikovano je ukupno 65 outlajera.
Ovako veliki broj ekstremnih vrednosti ukazuje na značajne varijacije u nivoima ovog enzima među pacijentima.
Budući da je GGT osetljiv pokazatelj oštećenja jetre i žučnih puteva, ove visoke vrednosti (koje dosežu i do 650.9) klinički su veoma značajne jer ukazuju na ozbiljne zdravstvene probleme..

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$GGT, main = "Boxplot za GGT", horizontal = TRUE)
```

Boxplot za kolonu GGT ukazuje na izrazito desno asimetričnu raspodelu sa velikim brojem gornjih outlajera.
Ovakav grafički prikaz potvrđuje prisustvo grupe pacijenata sa drastično povišenim nivoima enzima, što je od ključnog značaja za dijagnostiku oštećenja jetre i problema sa žučnim putevima, i zbog toga outlajeri neće biti uklonjeni iz dalje analize.

**Kolona PROT**

```{r}
summary(dataset$PROT)
```

Vrednosti parametra PROT su u rasponu od 44.80 do 90.00.
Srednja vrednost iznosi 72.04, dok je medijana 72.20, što ukazuje na približno simetričnu raspodelu bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na PROT

```{r}
ggplot(dataset, aes(x = PROT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele PROT")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti PROT u opsegu između približno 65 i 80.
Raspodela je relativno simetrična, uz prisustvo manjeg broja nižih i viših vrednosti.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$PROT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$PROT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$PROT[dataset$PROT < donja_granica | dataset$PROT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu PROT, donji kvartil iznosi 60.15, dok je gornji 84.55.
Primenom IQR metode, identifikovano je 20 outlajera.
Primećujemo značajan broj outlajera koji su ispod proseka (npr. 44.8, 47.0).
Kako je jetra odgovorna za stvaranje skoro svih proteina u našoj krvi, ovi niski rezultati su direktan pokazatelj da jetra kod tih pacijenata verovatno ne funkcioniše kako treba i da ne može da proizvede dovoljno proteina.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$PROT, main = "Boxplot za PROT", horizontal = TRUE)
```

Boxplot za kolonu PROT ukazuje na prisustvo outlajera na oba kraja distribucije, što ukazuje na pacijente sa vrednostima koje značajno odstupaju od proseka.
Ovakav grafički prikaz potvrđuje postojanje grupe pacijenata sa smanjenom koncentracijom proteina, što je od ključnog značaja za dijagnostiku poremećaja u ishrani, kao i potencijalnih problema sa radom jetre, i zbog toga outlajere nećemo ukloniti iz dalje analize.

## Logička i bivarijantna analiza podataka

Nakon uradjene univarijantne analize, kojom smo prikazali ekstremne vrednosti u okviru pojedinačnih laboratorijskih parametara, uradićemo i logičku analizu odnosa između različitih parametara.
Dok univarijantni pristup detektuje vrednosti koje odstupaju od proseka, bivarijantna i multivarijantna analiza omogućavaju uočavanje onih podataka koji su unutar "normalnih" granica kada se posmatraju izolovano, ali formiraju medicinski nemoguće ili sumnjive kombinacije.

**Provera odnosa ALB i PROT**

Prvo ćemo proveriti odnos izmedju albumina(ALB), najzastupljenijeg proteina u krvi, i ukupnih proteina(PROT).
Kako je albumin samo jedan od proteina njegova vrednost ne može prelaziti vrednost ukupnih proteina.

Ovim kodom izolujemo redove gde je albumin veći od ukupnih proteina, što je logička greška.

```{r}
greske_alb_prot <- dataset[which(dataset$ALB > dataset$PROT), ]
nrow(greske_alb_prot)
```

```{r}
greske_alb_prot
```

Vidimo da takvih redova ima samo jedan.
Sledećim grafikom ćemo vizuelno prikazati red u kom se nalazi pacijent kojem je albumin veći od ukupnih proteina.

```{r}
ggplot(dataset, aes(x = PROT, y = ALB)) +
  geom_point(alpha = 0.5) +
  geom_abline(color = "red") 
```

Obrisaćemo red koji krši logičko pravilo.

```{r}
dataset <- dataset[dataset$X != 217, ]

nrow(dataset[dataset$X == 217, ])
```

**Validacija zdravih donora (Category 0)**

Kategorija "Blood Donor" predstavlja zdrave pacijente.
Iako su u medicini odstupanja moguća, ekstremno visoke vrednosti enzima jetre kod zdravih pacijenata narušavaju definiciju kategorije.
Ukoliko pacijent označen kao "Blood Donor" ima vrednosti AST ili ALT koje su višestruko iznad gornje granice normale (npr.\> 200 U/L), taj red se smatra nereprezentativnim za ciljnu kategoriju.

```{r}
sumnjivi_donori <- dataset[which(dataset$Category == "0=Blood Donor" & (dataset$AST > 200 | dataset$ALT > 200)), ]

sumnjivi_donori
```

Vidimo da u kategoriji "Blood Donor" nema pacijenata sa ekstremno povišenim vrednostima AST i ALT enzima(iznad 200 U/L).

**Konzistentnost holinesteraze (CHE) kod ciroze**

Holinesteraza(CHE) je jedan od najpouzdanijih pokazatelja sposobnosti jetre da proizvodi proteine.
Kod pacijenata koji imaju cirozu, nivo holinesteraze je po pravilu veoma nizak.
Ukoliko pacijent označen kao "Cirrhosis" ima visoke vrednosti CHE(npr.\> 10 kU/L), taj red se smatra nereprezentativnim za ciljnu kategoriju, jer protivreči patofiziološkom stanju ciroze.

```{r}
sumnjiva_ciroza <- dataset[which(dataset$Category == "3=Cirrhosis" & dataset$CHE > 10), ]

sumnjiva_ciroza
```

Vidimo da u kategoriji "Cirrhosis" nema pacijenata sa visokim vrednostima CHE (iznad 10 kU/L).

**Kolona Category - izlazna kolona**

Pošto je Category kategorijska kolona prikazaćemo tabelu učestalosti da bismo videli koliko puta se svaka kategorija pojavljuje.

```{r}
table(dataset$Category)
```

Izlazna kolona Category predstavlja zdravstveni status pacijenta i sadrži pet klasa: 0 – Blood Donor, 0s – Suspect Blood Donor, 1 – Hepatitis, 2 – Fibrosis i 3 – Cirrhosis.

Grafički prikaz raspodele kategorija

```{r}
ggplot(dataset, aes(x = Category)) +
  geom_bar() +
  labs(title = "Raspodela kategorija zdravstvenog statusa pacijenata u datasetu")
```

Na osnovu tabele učestalosti i grafičkog prikaza, uočavamo značajan disbalans klasa.
Kategorija "0=Blood Donor" dominira sa 532(533) uzorka, dok su ostale kategorije izrazito malobrojne.

Kako bismo napravili što bolji modela mašinskog učenja i omogućili mu da lakše prepozna razlike, uradićemo spajanje kategorija u dve logičke celine (binarna klasifikacija):

1.  Blood Donor – Spajamo kategorije "0=Blood Donor" i "0s=suspect Blood Donor", jer su sumnjivi donori idalje pacijenti koji nemaju potvrđeno oboljenje jetre.

2.  Hepatitis C – Spajamo kategorije "1=Hepatitis", "2=Fibrosis" i "3=Cirrhosis", jer one zapravo predstavljaju različite stadijume progresije iste bolesti

```{r}
dataset$Target <- ifelse(dataset$Category %in% c("0=Blood Donor", "0s=suspect Blood Donor"), 
                         "Blood Donor", "Hepatitis C")

dataset$Target <- as.factor(dataset$Target)

table(dataset$Target)
```

# Analiza podataka

## Analiza izmedju prediktora i odgovora

U skladu sa medicinskim činjenicama, najvažniji pokazatelji oštećenja jetre su ALT, AST, GGT i BIL, pri čemu kombinacije ovih parametara daju bolje rezultate u razlikovanju zdravih pacijenata i pacijenata sa hepatitisom C nego pojedinačni parametri.

## Kolona ALT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ALT enzima.

```{r}
ggplot(data = dataset, aes(x = Target, y = ALT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALT vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALT"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

ALT bi u većini slučajeva trebalo da bude viši kod pacijenata sa oštećenjem jetre, ali to nije uvek pravilo, kod nekih pacijenata ALT može biti normalan ili da se menja kroz vreme, pa zato vidimo preklapanje između kategorija na boxplotu. Zbog toga ALT nije dovoljan sam za pouzdanu procenu, pa ćemo u nastavku uraditi analizu u kombinaciji sa drugim parametrima jetre.

## Kolona AST

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti AST enzima.

```{r}
ggplot(data = dataset, aes(x = Target, y = AST)) +
  geom_boxplot() +
  labs(
    title = "Distribucija AST vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "AST"
  ) +
 theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafiku vidimo da su AST vrednosti kod pacijenata sa oštećenjem jetre u proseku više nego kod zdravih pacijenata, uz mnogo veći raspon. Za razliku od ALT-a, ovde je razlika između kategorija izraženija. Zbog toga zaključujemo da AST može biti značajan prediktor u ovom skupu podataka.

## Kolona GGT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti GGT enzima.

```{r}
ggplot(data = dataset, aes(x = Target, y = GGT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija GGT vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "GGT"
  ) +
 theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafika vidimo da se vrednosti GGT kod zdravih pacijenata i onima sa oštećenjem jetre skoro uopšte ne preklapaju. Dakle, kod zdravih pacijenata GGT ima dosta niže vrednosti, dok kod pacijenata sa oštećenjem jetre vidimo značajno višu medijanu i veći raspon, što i jeste u skladu sa medicinskim činjenicama. Na osnovu ovoga možemo da zaključimo da bi GGT bio vrlo značajan prediktor za naš model.

## Kolona BIL

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti BIL.

```{r}
ggplot(data = dataset, aes(x = Target, y = BIL)) +
  geom_boxplot() +
  labs(
    title = "Distribucija BIL vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "BIL"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Nivo bilirubina kod zdravih pacijenata je nizak, dok porast vrednosti prate progresivna oštećenja jetre, kao što i vidimo na grafiku. Kategorija pacijenata sa oštečenjem jetre ima viši nivo medijane i značajno veći broj ekstremnih vrednosti. Dakle, možemo da zaključimo da je BIL takođe značajan kandidat za predikciju.

## Kolona ALB

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti albumina (ALB).

```{r}
ggplot(data = dataset, aes(x = Target, y = ALB)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALB vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALB"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Na osnovu grafika vidimo da postoji jasno preklapanje izmedju kategorija. Iako se kod pacijenata sa oštećenjem jetre primećuje blagi pad medijane i širi raspon nižih vrednosti, većina njihovih rezultata i dalje pada u opseg normalnih vrednosti za zdrave pacijente. Na osnovu ovoga možemo da zaključimo da ALB ne bi bio značajan samostalan prediktor.

## Kolona ALP

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ALP enzima.

```{r}
ggplot(data = dataset, aes(x = Target, y = ALP)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALP vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALP"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafika vidimo gotovo potpuno preklapanje interkvartilnih opsega obe kategorije, odnosno većina podataka za obe kategorije se nalazi u istom opsegu, što bi onemogućilo modelu da jasno definiše granicu između kategorija samo na osnovu ovog parametra.

## Kolona CHE

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti CHE enzima.

```{r}
ggplot(data = dataset, aes(x = Target, y = CHE)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CHE vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CHE"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafika vidimo preklapanje interkvartilnih opsega između zdravih pacijenata i pacijenata sa oštećenjem jetre. Takodje, vidimo i trend pada vrednosti CHE kod pacijenata sa oštećenjem jetre, i raspon vrednosti je znatno širi. U nastavku ćemo uraditi analizu u kombinaciji sa drugim parametrima jetre.

## Kolona CHOL

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti holesterola (CHOL).

```{r}
ggplot(data = dataset, aes(x = Target, y = CHOL)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CHOL vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CHOL"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafika vidimo preklapanje interkvartilnih opsega između zdravih pacijenata i pacijenata sa oštećenjem jetre, sa trendom nižih vrednosti kod bolesne grupe, gde je medijana pomerena naniže u odnosu na zdravu grupu. Takodje i ovde možemo zaključiti da iako CHOL nije značajan samostalan prediktor, u kombinaciji sa drugim parametrima bi mogao omogućiti modelu da preciznije prediktuje.

## Kolona CREA

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti kreatinina (CREA).

```{r}
ggplot(data = dataset, aes(x = Target, y = CREA)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CREA vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CREA"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Kreatinin zapravo nije primarni marker za jetru, već za funkciju bubrega, što možemo da vidimo i na distribuciji podataka. Dakle, na osnovu grafika vidimo skoro potpuno preklapanje interkvartilnih opsega, što ukazuje na to da CREA samostalno ne predstavlja pouzdan indikator u razlikovanju zdravih pacijenata od pacijenata sa oštećenjem jetre.


## Kolona PROT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ukupnih proteina (PROT).

```{r}
ggplot(data = dataset, aes(x = Target, y = PROT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija vrednosti proteina po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "PROT"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu grafika vidimo preklapanje interkvartilnih opsega između zdravih pacijenata i onih sa oštečenjem jetre Iako kategorija pacijenata sa oštečenjem jetre pokazuje nešto širi raspon vrednosti naviše, medijane obe grupe su pozicionirane veoma blizu. Dakle, PROT samostalno ne predstavlja pouzdan indikator u razlikovanju zdravih pacijenata od pacijenata sa oštećenjem jetre.

## Kolona Age

Grafikom ispod prikazan je odnos između kategorije pacijenata i starosti.

```{r}
ggplot(data = dataset, aes(x = Target, y = Age)) +
  geom_boxplot() +
  labs(
    title = "Distribucija starosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "Age"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Takodje, i ovde na osnovu grafika vidimo preklapanje interkvartilnih opsega između zdravih pacijenata i pacijenata sa oštećenjem jetre, što ukazuje na to da starost sama po sebi nije značajan prediktor za prisustvo bolesti.

## Kolona Sex

Grafikom ispod prikazan je odnos između kategorije pacijenata i polova.

```{r}
ggplot(data = dataset, aes(x = Target, fill = Sex)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Distribucija pola po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "Broj pacijenata",
    fill = "Pol"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Na osnovu prikazanog grafikona može se uočiti da je u obe kategorije pacijenata zastupljen veći broj muškaraca u odnosu na žene. Dakle sam pol, u okviru ovog skupa podataka, ne predstavlja dobar prediktor za razlikovanje pacijenata sa oštećenjem jetre od zdravih pacijenata.

## Multivarijantna analiza

Nakon detaljne univarijantne analize pojedinačnih biohemijskih parametara, pokušaćemo da pronađemo povezanost između više parametara. 

## Odnos AST i ALT

ALT i AST u krvi su ključni markeri oštećenja jetre, jer se ovi enzimi oslobađaju iz ćelija jetre kada su one oštećene. Odnos između njih pomaže lekarima u proceni oštećenja jetre.
Primenićemo logaritamsku skalu, zato što AST i ALT u ovom skupu podataka imaju ogroman opseg, od normalnih vrednosti do ekstremnih vrednosti, koje bi "pogurale" sve ostale tačke u jedan ugao grafika.

```{r}
ggplot(dataset, aes(x = AST, y = ALT)) +
  geom_point(alpha = 0.6, size = 2.5, color = "#e74c3c") +
  scale_x_log10() +
  scale_y_log10() +
  labs(title = "AST vs ALT", x = "AST", y = "ALT") +
  theme_minimal()
```

Na osnovu grafika vidimo da kako rastu vrednosti AST, tako rastu i vrednosti ALT, ali i da značajan broj opservacija odstupa od linearne regresije.

## Odnos AST i ALT po kategorijama pacijenata

```{r}
ggplot(dataset, aes(x = AST, y = ALT, color = Target)) +
  geom_point(alpha = 0.6, size = 2.5) +
  scale_x_log10() + 
  scale_y_log10() +
  labs(title = "Odnos AST i ALT: Marker oštećenja ćelija",
       x = "AST",
       y = "ALT") +
  theme_minimal()
```

Dodavanjem izlazne kolone na grafik, vidimo da pomenuta odstupanja nisu slučajna već da su povezana sa dijagnozom, odnosno pripadaju pacijentima sa oštećenjem jetre. Dakle, vidimo da su kod najvećeg broja zdravih pacijenata vrednosti AST i ALT koncentrisane u veoma uskom opsegu normalnih fizioloških vrednosti. Za razliku od zdravih pacijenata, kod onih koji imaju oštećenje jetre vidimo izrazitu raspršenost podataka, što nam verovatno govori o različitim stadijumima oštećenja jetre.

## Odnos ALB i PROT

Albumin je najzastupljeniji protein u krvnoj plazmi i kod zdrave osobe čini oko 50% do 60% ukupnih proteina. Zbog toga je logično da svaka promena u nivou albumina direktno utiče na nivo ukupnih proteina.

```{r}
ggplot(dataset, aes(x = ALB, y = PROT)) +
  geom_point(alpha = 0.6, size = 2.5, color = "#e74c3c") +
  labs(title = "Odnos ALB i PROT", x = "ALB", y = "PROT") +
  theme_minimal()
```

Na osnovu grafika vidimo da kao što smo prethodno rekli postoji linearna zavisnost između albumina i ukupnih proteina.

## Odnos ALB i PROT po kategorijama pacijenata

```{r}
ggplot(dataset, aes(x = ALB, y = PROT, color = Target)) +
  geom_point(alpha = 0.6, size = 2.5) +
  labs(title = "Odnos ALB i PROT po kategorijama pacijenata", x = "ALB", y = "PROT") +
  theme_minimal()
```

Dodavanjem izlazne kolone na grafik vidimo da se kategorije u velikoj meri preklapaju. Kod mnogih pacijenata sa Hepatitisom C, jetra je pod upalom, ali još uvek uspeva da proizvodi dovoljno proteina.

## Odnos GGT i AST po kategorijama pacijenata

Na osnovu prethodnih analiza videli smo da su GGT i AST pojedinačno značajni prediktori i zbog toga ćemo sada pogledati njihov medjusobni odnos.

```{r}
ggplot(dataset, aes(x = GGT, y = AST, color = Target)) +
  geom_point(alpha = 0.6, size = 2.5) +
  scale_x_log10() + 
  labs(title = "Odnos GGT i AST po kategorijama") +
  theme_minimal()
```
Na osnovu grafika vidimo razdvajanje izmedju kategorija. Zdravi pacijenti su koncentrisani u području niskih vrednosti oba parametra, dok kod pacijenata sa oštećenjem jetre dolazi do rasipanja vrednosti ka višim vrednostima oba parametra. Takodje vidimo da su vrednosti GGT povišene i kada su vrednosti AST relativno stabilne.

# Zaključak na osnovu celokupne analize

Na osnovu sprovedene analize može se zaključiti da zdravstveni status pacijenata snažno zavisi od više biohemijskih parametara krvi, među kojima se posebno izdvajaju AST i GGT kao najvažniji pokazatelji oštećenja jetre.
Pored njih, odnosno u kombinaciji sa njima, bi značajnu ulogu mogli da imaju i drugi biohemijski parametri poput BIL, ALT, ALB i PROT.
Demografske promenljive, starost i pol, pokazuju slabiji uticaj u poređenju sa biohemijskim parametrima.
Na osnovu kombinacije domenskog znanja i analize grafičkih prikaza, može se zaključiti da je opravdano razviti model predikcije koji će se prvenstveno oslanjati na biohemijske parametre.
U nastavku rada biće ispitano koliko dobar prediktivni model može da se izgradi na osnovu ovih promenljivih.

# Korelaciona matrica

```{r}
cor_matrix <- cor(dataset %>% 
                    select_if(is.numeric) %>% 
                    select(-X))

cor_matrix
```

Korelaciona matrica omogućava prikaz povezanosti između numeričkih kolona. Na osnovu matrice može se uočiti da ALB i PROT imaju umerenu pozitivnu korelaciju od oko 0.58, što kao što smo već prethodno pomenuli ukazuje da se povećanje vrednosti jedne varijable uglavnom prati povećanjem druge. Takodje, GGT i ALP imaju umerenu pozitivnu korelaciju od oko 0.44, kao i GGT I AST(oko 0.49), što smo prethodno mogli i da vidimo na grafičkom prikazu. CHE i CHOL isto imaju umerenu pozitivnu korelaciju od oko 0.42, dok ostale promenljive imaju korelaciju ispod 0.4, što pokazuje slabu linearnu povezanost među njima.

# Analiza varijanse (ANOVA)

Feature Selection pomoću ANOVA je statistička metoda kojom biramo najznačajnije prediktore iz skupa podataka kako bismo poboljšali preciznost i brzinu mašinskog modela. ANOVA se koristi kada imamo numeričke ulazne podatke i kategoričku ciljnu kolonu kao što je slučaj u našem skupu podataka.

```{r}
numeric_cols <- names(dataset)[sapply(dataset, is.numeric)]
numeric_cols <- setdiff(numeric_cols, "X")

anova_results <- lapply(numeric_cols, function(col) {
  formula <- as.formula(paste(col, "~ Target"))
  res <- aov(formula, data = dataset)
  summary_res <- summary(res)[[1]]
  data.frame(
    Feature = col,
    F_value = summary_res["Target", "F value"],
    p_value = summary_res["Target", "Pr(>F)"]
  )
})

anova_table <- do.call(rbind, anova_results)
anova_table <- anova_table[order(-anova_table$F_value), ]

print(anova_table)
```

Na osnovu rezultata vidimo da je najznačajniji prediktor AST, što potvrđuje njegovu važnost kao pokazatelja oštećenja jetre. GGT se takođe izdvaja kao veoma snažan prediktor, kao i BIL. Umereno značajni prediktori su CHOL, CHE i ALB, dok su CREA i ALT slabiji, ali mogu da budu statistički značajni. PROT, ALP i Age ne pokazuju razliku između grupa i nisu statistički značajni. Ovi rezultati potvrđuju prethodne analize.

# Kreiranje modela

Prvo pripremamo podatke tako što kategorijske promenljive pretvaramo u factor.

```{r}
dataset$Target = factor(dataset$Target)
dataset$Sex = factor(dataset$Sex)
```

Pre kreiranja prvog modela moramo i da prilagodimo ciljnu promenljivu kako bi bila pogodna za primenu algoritama mašinskog učenja. S obyirom na to smo ciljnu promenljivu sveli na dve kategorje (Blood donor i Hepatitis C), ona se kodira binarno. U ovom slučaju, vrednost 0 ćemo dodeliti zdravim pacijentima, a vrednost 1 onima sa oštećenjem jetre zato što je cilj modela predikcija prisustva hepatitisa C

```{r}
dataset$Target_binary <- ifelse(dataset$Target == "Blood Donor", 0, 1)
```

```{r}
dataset$Target_binary
```


Podela podataka na train:test skup u odnosu 80:20.
Stratifikacija na osnovu kolone Target_binary.

```{r}
set.seed(123)
train_index <- createDataPartition(dataset$Target_binary,
                                      p = 0.8,
                                      list = FALSE)

train_bin <- dataset[train_index, ]
test_bin  <- dataset[-train_index, ]
```


```{r}
prop.table(table(train_bin$Target_binary))
prop.table(table(test_bin$Target_binary))
```

```{r}
# Decision tree sa binarnom klasifikacijom
tree_model_bin <- rpart(Target_binary ~ ALT + AST + GGT + BIL + ALB,
                        method = "class",
                        data = train_bin)

summary(tree_model_bin)

rpart.plot(tree_model_bin,
           main = "Decision tree – binarna klasifikacija",
           extra = 104)
```

U čvoru 1 (Node 1) nalazi se svih 492 posmatranja iz trening skupa, pri čemu je većina pacijenata zdrava (432), dok je 60 označeno kao obolelo. Model u ovom čvoru predviđa klasu No_disease, ali očekivani gubitak od oko 12% pokazuje da bez dodatnih podela još uvek postoji značajna neizvesnost. Kao najvažniji kriterijum razdvajanja model bira vrednost AST, što ukazuje da je ovaj enzim ključni faktor za razlikovanje zdravih i bolesnih pacijenata u datom skupu podataka.

U Node 2, koji nastaje kada je AST manji od 53.05, nalazi se čak 445 pacijenata, odnosno više od 90% celog skupa. Ovde je dominantna klasa No_disease, sa verovatnoćom od oko 95%. Očekivani gubitak je vrlo nizak (oko 4%), što pokazuje da model sa velikom sigurnošću prepoznaje zdrave osobe kada je AST u normalnom rasponu. To znači da niska vrednost AST snažno smanjuje verovatnoću bolesti.

Unutar ovog čvora model uvodi dodatnu podelu na osnovu ALT vrednosti. U Node 4, gde su i AST i ALT niski, nalazi se najveći broj pacijenata (432), a gotovo svi su zdravi. Verovatnoća klase No_disease dostiže skoro 98%, a očekivani gubitak je minimalan. Ovaj deo stabla predstavlja najstabilniji i najpouzdaniji deo modela, jer jasno pokazuje da kombinacija niskog AST i niskog ALT gotovo uvek ukazuje na nizak nivo bolesti jetre.

Nasuprot tome, Node 5 obuhvata samo 13 pacijenata sa niskim AST, ali povišenim ALT. Iako model ovde većinski predviđa bolest (oko 77%), broj posmatranja je veoma mali, pa se zaključci moraju tumačiti malo opreznije. Ovaj čvor nam pokazuje da povišen ALT može biti rizičan čak i kada je AST nizak, ali zbog malog uzorka ne može se donositi čvrst zaključak bez dodatnih podataka.

Sa druge strane imamo Node 3, koji obuhvata pacijente sa AST većim ili jednakim 53.05. Ovde model uglavnom predviđa bolest, sa verovatnoćom od oko 87%. Ipak, prisustvo šest zdravih pacijenata u ovom čvoru pokazuje da povišen AST ne znači automatski bolest, već povećava rizik. Očekivani gubitak od oko 13% ukazuje da je model u ovoj grani manje siguran nego u slučajevima sa niskim AST.

Sveukupno, stablo pokazuje da model najbolje funkcioniše kada su vrednosti AST i ALT niske, jer tada gotovo bez greške prepoznaje zdrave osobe. Najveću nesigurnost ima u manjim podgrupama sa povišenim enzimima, što ukazuje da su za te slučajeve potrebni dodatni podaci ili složeniji modeli kako bi se poboljšala preciznost predikcije.


## Logistička regresija

```{r}
# Kopija podataka
dataset_log <- dataset

# Standardizacija numeričkih kolona
num_cols <- sapply(dataset_log, is.numeric)
num_cols["Target_binary"] <- FALSE
dataset_log[num_cols] <- scale(dataset_log[num_cols])

set.seed(123)
trainIndex_log <- createDataPartition(dataset_log$Target_binary,
                                      p = 0.8,
                                      list = FALSE)

train_log <- dataset_log[trainIndex_log, ]
test_log  <- dataset_log[-trainIndex_log, ]
```

Napravljena je kopija podataka kako bi originalni skup ostao neizmenjen, dok su numerički atributi skalirani jer logistička regresija zavisi od skale podataka i može dati nepouzdane rezultate ako se koriste neujednačene vrednosti.

```{r}
# Pokreni model
log_model <- glm(Target_binary ~ ALT + AST + GGT + ALB + BIL, 
                 data = train_log, 
                 family = binomial)

summary(log_model)
```
Značajno smanjenje devijanse u odnosu na nul-model ukazuje da uključeni prediktori imaju važan doprinos u objašnjenju ciljne promenljive.
Rezultati logističke regresije pokazuju da su AST, GGT i BIL statistički značajni prediktori pojave oboljenja jetre, dok ALT ima negativan uticaj na verovatnoću pripadnosti klasi obolelih. Sa druge strane, ALB se ne pokazuje kao značajan prediktor u okviru ovog modela (p > 0.05).

#Predikcija - Logistička regresija
```{r}
# Predikcija verovatnoća
log_pred_prob <- predict(log_model,
                         newdata = test_log,
                         type = "response")

# Binarna odluka (koristimo 0 i 1 da se poklopi sa Target_binary)
log_pred <- ifelse(log_pred_prob > 0.5, 1, 0)

# Confusion matrix
# Pretvaramo oba u faktor sa istim nivoima (0 i 1)
confusionMatrix(
  factor(log_pred, levels = c(0, 1)),
  factor(test_log$Target_binary, levels = c(0, 1))
)
```

Na test skupu logistička regresija postiže visoku ukupnu tačnost od 91,8%, što na prvi pogled deluje kao veoma dobar rezultat. Međutim, pošto u podacima ima mnogo više zdravih nego bolesnih pacijenata, sama tačnost nije dovoljna da bismo ocenili kvalitet modela. Zbog toga su važnije mere osetljivosti i specifičnosti, jer bolje pokazuju kako model greši. Model ima veoma visoku osetljivost za zdrave pacijente (Sensitivity = 0.97), što znači da gotovo sve zdrave osobe pravilno prepoznaje. Sa druge strane, specifičnost je znatno niža i iznosi 0.53, što znači da model često pogrešno svrstava bolesne pacijente u grupu zdravih. Drugim rečima, model je sklon da češće kaže da je pacijent zdrav, čak i kada to nije tačno.

Balanced accuracy od oko 75% daje realniju sliku uspešnosti modela jer uzima u obzir rezultate za obe klase, a ne samo za zdrave pacijente. Kappa koeficijent od 0.57 pokazuje da model ima umereno dobro slaganje sa stvarnim dijagnozama, ali da i dalje postoji prostor za poboljšanje. Sve zajedno, ovi rezultati pokazuju da model generalno dobro radi, ali ima jasna ograničenja u prepoznavanju bolesnih pacijenata, pa bi bio korisniji kao pomoćni alat za skrining nego kao konačna medicinska odluka..

#Predikcija - Decision Tree
```{r}
# Predikcija klasa na test skupu
tree_pred <- predict(tree_model_bin,
                     newdata = test_bin,
                     type = "class")

# Confusion matrix
confusionMatrix(tree_pred, as.factor(test_bin$Target_binary), positive = "1")

```
Na test skupu decision tree postiže visoku tačnost od 92,6%, što pokazuje da model generalno veoma dobro klasifikuje pacijente. Kappa koeficijent od 0,70 ukazuje na dobro slaganje između predikcija modela i stvarnih vrednosti, pa se može zaključiti da model ne pogađa nasumično već zaista uči relevantne obrasce iz podataka.

Model pokazuje uravnoteženije performanse u poređenju sa logističkom regresijom. Osetljivost za obolele pacijente iznosi 0,87, što znači da većinu bolesnih model uspešno prepoznaje, dok je specifičnost vrlo visoka (0,93), pa model retko greši kada su u pitanju zdravi pacijenti.

Negativna prediktivna vrednost je veoma visoka (0,98), što znači da je predikcija „zdrav“ uglavnom pouzdana, dok niža pozitivna prediktivna vrednost (0,65) pokazuje da predikcija bolesti nosi veću verovatnoću greške. Sveukupno, stablo odlučivanja se pokazuje kao pouzdaniji i uravnoteženiji model od logističke regresije.

```{r}
library(pROC)

# Logistic regression ROC
roc_lr <- roc(
  test_log$Target_binary,
  log_pred_prob,
  levels = c(0, 1),
  direction = "<"
)

# Decision Tree ROC
tree_prob <- predict(tree_model_bin, test_bin, type = "prob")[, "1"]

roc_dt <- roc(
  test_bin$Target_binary,
  tree_prob,
  levels = c(0, 1),
  direction = "<"
)

# Plotovanje
plot(roc_lr, col = "blue", lwd = 2, main = "ROC upoređivanje: LR vs Decision Tree")
lines(roc_dt, col = "red", lwd = 2)

# Legenda sa dinamičkim AUC vrednostima
legend("bottomright",
       legend = c(
         paste("Logistička regresija (AUC =", round(auc(roc_lr), 3), ")"),
         paste("Decision Tree (AUC =", round(auc(roc_dt), 3), ")")
       ),
       col = c("blue", "red"),
       lwd = 2)
```

Na osnovu ROC krivih može se uočiti da oba modela ostvaruju veoma dobre performanse klasifikacije, jer se njihove krive nalaze znatno iznad dijagonale koja predstavlja slučajnu klasifikaciju. Logistička regresija ima veću AUC vrednost (AUC = 0.964) u poređenju sa decision tree modelom (AUC = 0.914), što ukazuje da logistička regresija u proseku bolje rangira posmatranja po verovatnoći pripadnosti klasi obolelih, nezavisno od izabranog praga.

Međutim, iako logistička regresija ima višu ukupnu diskriminativnu moć, decision tree model pokazuje konkurentne performanse i ostvaruje dobar balans između osetljivosti i specifičnosti u relevantnom delu ROC prostora. Razlika između krivih je relativno mala, što sugeriše da oba modela pružaju pouzdane predikcije, ali sa različitim prednostima u zavisnosti od kriterijuma evaluacije.

# Random Forest

Random Forest koristi niz odluka donešenih od strane više stabala odluke kako bi došao do konačne odluke odnosno predikcije. Dakle, kao i kod Decision Tree, ne zahteva skaliranje numeričkih vrednosti jer se podele unutar stabala vrše na osnovu pragova vrednosti.

```{r}
train_bin$Target_binary <- factor(train_bin$Target_binary)
test_bin$Target_binary  <- factor(test_bin$Target_binary)

set.seed(123) 
rf_model <- randomForest(
  formula = Target_binary ~ AST + ALT + GGT + BIL + ALP, 
  data = train_bin, 
  ntree = 500,
  importance = TRUE
)

print(rf_model)

importance(rf_model)
varImpPlot(rf_model, main = "Značajnost parametara u RF modelu")
```

Na osnovu rezultata Random Forest modela možemo uočiti da model postiže visok stepen tačnosti u razdvajanju zdravih pacijenata i pacijenata sa oboljenjem jetre.

Ukupna OOB stopa greške iznosi oko 3.05%, što ukazuje da model pouzdano klasifikuje podatke i da je generalizacija na nove podatke dobra. Na osnovu konfuzione matrice vidimo da je većina zdravih pacijenara pravilno klasifikovana, uz manji procenat pogrešnih klasifikacija. Slično tome, i kod osoba sa oboljenjem jetre model ostvaruje dobre rezultate.

Kao što smo videli na osnovu prethodnih analiza, analiza značajnosti prediktora pokazuje da je promenljiva AST najznačajnija za donošenje odluka u modelu, jer ima najveće vrednosti i za Mean Decrease Accuracy i za Mean Decrease Gini. Takodje i ALT i GGT imaju značajan doprinos u razdvajanju klasa, dok BIL i ALP imaju umeren uticaj.

Za razliku od pojedinačnog stabla odlučivanja, Random Forest model kombinuje informacije iz velikog broja stabala, čime se smanjuje varijansa i povećava stabilnost modela. Model pruža robusnije i preciznije razdvajanje između zdravih pacijenata i pacijenata sa oboljenjem jetre, bez izraženog preklapanja klasa.


```{r}
predictions <- predict(rf_model, test_bin)

predictions <- as.factor(predictions)
test_bin$Target_binary <- as.factor(test_bin$Target_binary)

confusionMatrix(predictions, test_bin$Target_binary)
```

Na test skupu Random Forest model ostvaruje izuzetno visoku tačnost klasifikacije (Accuracy = 98.36%), što nam ukazuje na veoma pouzdano razdvajanje klasa.

Model pokazuje veoma visoku osetljivost za pozitivnu klasu (Sensitivity = 0.9907), u našem slučaju to je klasa pacijenata sa oštećenjem jetre, što znači da su skoro svi pozitivni slučajevi ispravno identifikovani. Takodje je i specifičnost je visoka (Specificity = 0.9333), što ukazuje na mali broj lažno pozitivnih predikcija.

Kappa koeficijent (0.924) ukazuje na skoro savršeno slaganje između stvarnih i predviđenih klasa, čak i kada se uzme u obzir neravnoteža klasa u podacima (Prevalence = 0.877). Balanced accuracy (0.962) dodatno potvrđuje da model postiže odlične performanse na obe klase.

Možemo da zaključimo da Random Forest model pokazuje bolju generalizaciju u odnosu na pojedinačno decision tree stablo, uz manju osetljivost na šum i varijacije u podacima. Ovo ga čini veoma pogodnim za praktičnu primenu u predikciji oboljenja jetre.

##Zaključak

Cilj analize bio je da se ispita koliko dobro različiti modeli mašinskog učenja mogu da predvide da li pacijent pripada grupi zdravih ili obolelih na osnovu vrednosti jetrenih enzima. Na osnovu svih sprovedenih analiza može se zaključiti da je klasifikacija moguća sa visokom tačnošću, pri čemu su AST, ALT i GGT najvažniji prediktori u većini modela.

Pojedinačno stablo odlučivanja dalo je dobar i interpretabilan model, ali je pokazalo određenu nestabilnost u manjim podgrupama podataka. Logistička regresija je imala visoku ukupnu tačnost i najbolju AUC vrednost na ROC krivoj, što znači da dobro rangira pacijente po riziku, ali je slabije prepoznavala obolele zbog neravnoteže klasa.

Najbolje rezultate je dao Random Forest model, koji je postigao najveću tačnost, vrlo visoku osetljivost i specifičnost, kao i skoro savršenu Kappa vrednost. Zbog toga se Random Forest može smatrati najpouzdanijim modelom za predikciju oboljenja jetre u ovom skupu podataka, jer bolje generalizuje na nove slučajeve i manje je osetljiv na šum u podacima.

