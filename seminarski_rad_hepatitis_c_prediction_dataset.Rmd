---
title: "Seminarski rad - Hepatitis C Prediction Dataset"
output:
  word_document: default
  html_document: default
date: "2025-12-15"
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Tema: Hepatitis C Naziv: hepatitis-c-dataset.csv

Hepatitis C Prediction Dataset je skup podataka koji pruža detaljan uvid u laboratorijske nalaze krvi i osnovne demografske karakteristike pacijenata, sa ciljem analize zdravlja jetre.
Podaci obuhvataju biohemijske parametre jetre, kao što su ALT, AST, GGT, bilirubin i albumin, koji su značajni indikatori oštećenja i funkcije jetre.
Ciljna promenljiva Category označava zdravstveni status pacijenata, uključujući zdrave davaoce krvi i različite stadijume oboljenja od Hepatitisa C (hepatitis, fibroza i ciroza).
Podaci uključuju kliničke pokazatelje i demografske informacije, a prikupljeni su radi omogućavanja analize i izgradnje modela klasifikacije za razlikovanje zdravih i obolelih pacijenata.

Link ka skupu podataka na kaggle sajtu: <https://www.kaggle.com/datasets/fedesoriano/hepatitis-c-dataset>

# Prikaz podataka

Učitavanje potrebnih biblioteka

```{r}
library(tidyverse)
library(Amelia)
library(nortest)
library(ggplot2)
library(corrplot)
library(rpart)
library(rpart.plot)
library(randomForest)
library(caret)
library(pROC) #za upoređivanje razlicitih modela kod predikcije
```

## Učitavanje skupa podataka

```{r}
dataset = read.csv("HepatitisCdata.csv", sep=",")
# dataset = read.csv("C:/Users/Teodora/Desktop/seminarski/HepatitisCdata.csv", sep=",")
View(dataset)
```

Funkcija head prikazuje prvih šest redova dataset-a i tako se upoznajemo sa podacima.

```{r}
head(dataset)
```

Funkcije ncol i nrow daju informacije o dimenzijama(broju kolona i broju redova) skupa podataka.
Skup podataka ima 14 kolona i 615 redova.

```{r}
ncol(dataset)
nrow(dataset)
```

Funkcija str nam daje strukturu skupa podataka.
Prikazuje tip podatka za svaku promenljivu, kao i prvih nekoliko vrednosti u svakoj koloni.
U skupu podataka se nalazi 12 numeričkih promenljivih(int, num) i 2 kategorijske promenljive(chr).

```{r}
str(dataset)
```

Skup podataka sadrži sledeće kolone:

1.  X – numerička promenljiva koja označava jedinstveni identifikacioni broj pacijenta
2.  Category – kategorijska promenljiva koja označava zdravstveni status pacijenta (0 – davalac krvi, 0s – sumnjivi davalac krvi, 1 – Hepatitis, 2 – Fibroza, 3 – Ciroza)
3.  Age – numerička promenljiva koja označava starost pacijenta u godinama
4.  Sex – kategorijska promenljiva koja označava pol pacijenta (m – muški, f – ženski)
5.  ALB – numerička promenljiva koja označava koncentraciju albumina u krvi
6.  ALP – numerička promenljiva koja označava nivo alkalne fosfataze u krvi
7.  ALT – numerička promenljiva koja označava nivo alanin-aminotransferaze u krvi
8.  AST – numerička promenljiva koja označava nivo aspartat-aminotransferaze u krvi
9.  BIL – numerička promenljiva koja označava nivo bilirubina u krvi
10. CHE – numerička promenljiva koja označava nivo holinesteraze u krvi
11. CHOL – numerička promenljiva koja označava nivo holesterola u krvi
12. CREA – numerička promenljiva koja označava nivo kreatinina u krvi
13. GGT – numerička promenljiva koja označava nivo gama-glutamil transferaze u krvi
14. PROT – numerička promenljiva koja označava ukupnu koncentraciju proteina u krvi

# Priprema podataka

## Nedostajuće vrednosti

Funkcija summary daje uvid u raspodelu podataka i može ukazati na nedostajuće vrednosti.

```{r}
summary(dataset)
```

Nedostajuće vrednosti po kolonama možemo prikazati kombinacijom funkcija is.na i colSums

```{r}
colSums(is.na(dataset))
```

Vidimo da ovaj skup podataka ima nedostajuće vrednosti u 5 numeričkih kolona i to su: ALB, ALP, ALT, CHOL i PROT.
Ove podatke je potrebno pripremiti za dalju analizu.

```{r}
colMeans(is.na(dataset))*100
```

```{r}
par(mfrow=c(1,1))
missmap(obj = dataset, main = "Hepatitis C dataset")
```

Ovo je procentualni prikaz nedostajućih vrednosti i vidimo da one čine mali procenat ukupnih podataka.

### Analiza i obrada nedostajućih vrednosti u numeričkim kolonama

Nedostojeće vrednosti kolone ALB

```{r}
sum(is.na(dataset$ALB))
```

U ovoj koloni imamo 1 podatak koji nedostaje.
Pošto podatke uvek bolje sačuvati nego obrisati, a u ovom slučaju imamo samo jedan podatak koji nedostaje, možemo upotrebiti metodu umetanja vrednosti kao npr.
mean ili median.
Izbor metode zavisi od distribucije podataka, zato moramo da proverimo kakva je distribucija podataka u ovoj koloni.
Shapiro-Wilk test koji smo ranije koristili je ograničen na 3-5000 podataka, što znači da možemo da upotrebimo na ovom koji ima 615 podataka.

```{r}
shapiro.test(dataset$ALB[!is.na(dataset$ALB)])
```
Na osnovu rezultata Shapiro–Wilk testa, odnosno veoma niske p-vrednosti možemo videti da raspodela vrednosti u koloni ALB značajno odstupa od normalne.
To nam ukazuje na prisustvo asimetrije i/ili ekstremnih vrednosti u podacima.
U takvoj situaciji aritmetička sredina može biti pod snažnim uticajem tih odstupanja i ne predstavlja tipičan rezultat, dok je medijana otpornija na ekstremne vrednosti i pruža realniji prikaz tipične vrednosti u skupu podataka, pa je pogodniji izbor za popunjavanje nedostajuće vrednosti.

```{r}
dataset$ALB[is.na(dataset$ALB)] <- median(dataset$ALB, na.rm = TRUE)

sum(is.na(dataset$ALB)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone ALP

```{r}
sum(is.na(dataset$ALP))
```

U ovoj koloni imamo 18 podataka koji nedostaju.
Ponovo koristimo Shapiro–Wilk test za proveru normalnosti kako bismo odredili koja vrednost je najpogodnija za umetanje.

```{r}
shapiro.test(dataset$ALP[!is.na(dataset$ALP)])
```

Na osnovu rezultata Shapiro–Wilk testa može se videti da je dobijena vrlo mala p-vrednost (p = 3.467e-16), što ukazuje na to da se raspodela vrednosti u koloni ALP značajno razlikuje od normalne.
To sugeriše prisustvo asimetrije ili ekstremnih vrednosti u podacima, zbog čega aritmetička sredina nije pouzdan izbor.
Medijana predstavlja stabilniju meru centralne tendencije i pogodnija je za imputaciju nedostajućih vrednosti u ovom slučaju.

```{r}
dataset$ALP[is.na(dataset$ALP)] <- median(dataset$ALP, na.rm = TRUE)

sum(is.na(dataset$ALP)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone ALT

```{r}
sum(is.na(dataset$ALT))
```

Pošto i u ovoj koloni postoji 1 nedostajući podatak, potrebno je proveriti kakva je raspodela vrednosti, kako bi se izabrala najprikladnija vrednost za umetanje.

```{r}
shapiro.test(dataset$ALT[!is.na(dataset$ALT)])
```
Na osnovu rezultata Shapiro–Wilk testa, možemo videti da raspodela vrednosti u koloni ALt značajno odstupa od normalne, što pokazuje veoma mala p-vrednost.
Ovakav rezultat ukazuje na prisustvo asimetrije i/ili ekstremnih vrednosti u podacima.
Dakle aritmetička sredina može biti pod snažnim uticajem tih odstupanja i ne predstavlja tipičan rezultat, dok je medijana otpornija na ekstremne vrednosti i pruža realniji prikaz tipične vrednosti u skupu podataka, pa je pogodniji izbor za popunjavanje nedostajuće vrednosti.

```{r}
dataset$ALT[is.na(dataset$ALT)] <- median(dataset$ALT, na.rm = TRUE)

sum(is.na(dataset$ALT)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone CHOL

```{r}
sum(is.na(dataset$CHOL))
```

U koloni CHOL prisutno je 10 nedostajućih vrednosti.
Pre nego što odaberemo način popunjavanja, potrebno je proveriti raspodelu podataka kako bismo izabrali najpogodniju meru centralne tendencije.

```{r}
shapiro.test(dataset$CHOL[!is.na(dataset$CHOL)])
```

Na osnovu rezultata Shapiro–Wilk testa može se videti da je p-vrednost vrlo mala (p = 0.0003), što znači da raspodela vrednosti u koloni CHOL nije normalna.
Iako je W prilično blizu 1, statistički značajno odstupanje sugeriše blagu asimetriju ili prisustvo ekstremnih vrednosti.
Zbog toga aritmetička sredina može biti pod uticajem tih vrednosti, pa je medijana stabilniji i pouzdaniji izbor za popunjavanje nedostajućih podataka.

```{r}
dataset$CHOL[is.na(dataset$CHOL)] <- median(dataset$CHOL, na.rm = TRUE)

sum(is.na(dataset$CHOL)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

Nedostojeće vrednosti kolone PROT

```{r}
sum(is.na(dataset$PROT))
```
Takodje, i u koloni PROT prisutna je samo 1 nedostojeća vrednost.
Potrebno je proveriti kakva je raspodela vrednosti, kako bi se izabrala najprikladnija vrednost za umetanje.

```{r}
shapiro.test(dataset$PROT[!is.na(dataset$PROT)])
```

Za kolonu PROT takođe je primenjen Shapiro–Wilk test, čiji rezultati ukazuju na značajno odstupanje od normalne raspodele (veoma mala p-vrednost).
Kao i u prethodnim slučajevima, zbog ovakve raspodele podataka i prisustva mogućih ekstremnih vrednosti, medijana je stabilniji i pouzdaniji izbor za popunjavanje nedostajućih podataka.

```{r}
dataset$PROT[is.na(dataset$PROT)] <- median(dataset$PROT, na.rm = TRUE)
```

```{r}

sum(is.na(dataset$PROT)) #Provera da li jos uvek ima vrednosti koje nedostaju
```

### Analiza i obrada nedostajućih vrednosti u kategorijskim kolonama

Proverićemo prisustvo nedostajućih vrednosti u kategorijskim kolonama Category i Sex.
Prvo ćemo koristiti frekvencijske tabele kako bismo identifikovali sve postojeće kategorije i proverili da li se pojavljuju neke neočekivane ili pogrešne vrednosti.
Zatim ćemo proveriti postojanje eksplicitnih NA vrednosti i praznih stringova.

```{r}
table(dataset$Category)
```

```{r}
sum(is.na(dataset$Category) | dataset$Category == "")
```

```{r}
table(dataset$Sex)
```

```{r}
sum(is.na(dataset$Sex) | dataset$Sex == "")
```

Na osnovu ovoga vidimo da u kolonama Category i Sex ne postoje neočekivane kategorije, NA vrednosti niti prazna polja.

## Analiza raspodele podataka po kolonama

Analiza raspodele promenljivih prikazuje kako su podaci rasporedjeni u okviru svake kolone, omogućava uočavanje obrazaca u podacima, identifikuje da li postoje izuzeci itd.
Za proveru postojanja izuzetaka(outlier-a) koristićemo jedan od jednostavnih pristupa,a to je IQR metoda. Glavna prednost ovog pristupa je u tome što se ne oslanja na aritmetičku sredinu, koja je izrazito osetljiva na ekstremne vrednosti, već na kvartile koji su znatno stabilniji. Metoda podrazumeva izračunavanje prvog (Q1) i trećeg kvartila (Q3), na osnovu kojih se određuju donja i gornja granica (Q1 - 1.5 * IQR i Q3 + 1.5 * IQR). Vrednosti koje odstupaju od ovih granica klasifikuju se kao izuzeci. Istovremeno, možemo napraviti boxplot za svaku kolonu kako bismo vizuelno prikazali ekstrema i lakše identifikovali outlajere.

**Kolona Age**

```{r}
summary(dataset$Age)
```

Starost pacijenata je u rasponu od 19 do 77 godina.
Srednja vrednost iznosi 47.41, dok je medijana 47, što ukazuje na približno simetričnu raspodelu.
Većina pacijenata nalazi se u srednjim starosnim kategorijama.

Grafički prikaz raspodele pacijenata u odnosu na broj godina

Histogram raspodele pacijenata po godinama

```{r}
ggplot(dataset, aes(x = Age)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele godina")
```

Na osnovu grafika vidimo da je najveći broj pacijenata starosti između 35 i 55 godina.
Raspodela je relativno ravnomerna, sa blagim asimetrijom, ali bez ekstremnih odstupanja.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$Age, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$Age, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$Age[dataset$Age < donja_granica | dataset$Age > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu Age vidimo da je donji kvartil 16.5, gornji kvartil 76.5, a pomoću IQR metode identifikovan je jedan outlajer.
To znači da postoji jedna vrednost koja odstupa od ostatka uzorka (77 godina), ali pošto nije jako ekstremna, njen uticaj na statistiku je mali i može se bez problema ostaviti u analizi.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$Age, main = "Boxplot za Age", horizontal = TRUE)
```

Na boxplotu mozemo tacno videti taj jedan outlajer koji se nalazi iznad 76.5.

**Kolona Sex**

Pošto je Sex kategorijska kolona prikazaćemo tabelu učestalosti da bismo videli koliko puta se svaka kategorija pojavljuje.

```{r}
table(dataset$Sex)
```

Grafički prikaz raspodele polova

```{r}
ggplot(dataset, aes(x = Sex)) +
  geom_bar() +
  labs(title = "Raspodela polova u datasetu")
```

Na osnovu tabele učestalosti i grafika vidimo da u skupu podataka ima više pacijenata muškog pola.

**Kolona ALB**

```{r}
summary(dataset$ALB)
```

Vrednosti parametra ALB su u rasponu od 14.9 do 82.2.
Srednja vrednost iznosi 41.62, dok je medijana 41.95, što ukazuje na približno simetričnu raspodelu bez izražene asimetrije.
Većina pacijenata ima vrednosti ALB koncentrisane oko srednjih vrednosti.

Grafički prikaz raspodele pacijenata u odnosu na ALB

```{r}
ggplot(dataset, aes(x = ALB)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALB")
```

Na osnovu grafika vidimo da je najveći broj pacijenata ima vrednost ALB u opsegu između 35 i 50.
Raspodela je relativno simetrična, uz prisustvo nekoliko ekstremnih vrednosti, što može ukazivati na potencijalne outlajere u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALB, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALB, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALB[dataset$ALB < donja_granica | dataset$ALB > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALB donji kvartil je 29.2, a gornji kvartil 54.8.
IQR metodom identifikovano je 27 outlajera, što ukazuje na veću varijabilnost podataka.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALB, main = "Boxplot za ALB", horizontal = TRUE)
```

I boxplot za kolonu ALB vizuelno potvrđuje prisustvo većeg broja outliera, koji su najizraženiji na donjem kraju raspodele, dok se nekoliko ekstremnih vrednosti uočava i na gornjem kraju.
S obzirom da se radi o kliničkom parametru, ove vrednosti najverovatnije predstavljaju stvarna odstupanja povezana sa zdravstvenim stanjem pacijenata, a ne greške u merenju.
Zbog toga outlajeri nećemo uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona ALP**

```{r}
summary(dataset$ALP)
```

Vrednosti parametra ALP su u rasponu od 11.30 do 416.60.
Srednja vrednost iznosi 66.20, dok je medijana 68.22, što ukazuje na relativno simetričnu raspodelu centralnog dela podataka, uz prisustvo blage desne asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na ALP

```{r}
ggplot(dataset, aes(x = ALP)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALP")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost ALP u opsegu između 50 i 100.
Raspodela ima izražen rep ka višim vrednostima, uz prisustvo nekoliko veoma visokih vrednosti, što ukazuje prisustvo outlajera u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALP, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALP, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALP[dataset$ALP < donja_granica | dataset$ALP > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALP donji kvartil iznosi 13.425, dok je gornji kvartil 118.825.
Primenom IQR metode identifikovano je ukupno 14 outlajera.
To ukazuje na postojanje vrednosti koje odstupaju od većine podataka, ali njihov broj nije izrazito velik u odnosu na ukupan uzorak.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALP, main = "Boxplot za ALP", horizontal = TRUE)
```

Boxplot za ALP ukazuje na desno asimetričnu raspodelu sa nekoliko visokih outlajera.
S obzirom da je ALP biohemijski parametar, ove ekstremne vrednosti mogu predstavljati realna klinička odstupanja, a ne greške u merenju, iz tog razloga outlajere nećemo uklonjeni iz dalje analize.

**Kolona ALT**

```{r}
summary(dataset$ALT)
```

Vrednosti parametra ALT su u rasponu od 0.90 do 325.30.
Srednja vrednost iznosi 28.44, dok je medijana 23.00.
Srednja vrednost je primetno veća od medijane, pa možemo zaključiti da raspodela pokazuje izrazitu desnu asimetriju.

Grafički prikaz raspodele pacijenata u odnosu na ALT

```{r}
ggplot(dataset, aes(x = ALT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele ALT")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost ALT u opsegu između 15 i 40.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje prisustvo značajnih outlajera u podacima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$ALT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$ALT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$ALT[dataset$ALT < donja_granica | dataset$ALT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu ALT donja granica za detekciju outlajera iznosi −8.575, dok je gornja granica 58.025.
Primenom IQR metode identifikovano je ukupno 36 gornjih outlajera, dok donjih nema.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$ALT, main = "Boxplot za ALT", horizontal = TRUE)
```

I boxplot za kolonu ALT vizuelno potvrđuje prisustvo Velikog broja gornjih outlajera, koji ukazuju na izraženu desnu asimetriju.
S obzirom da se radi o ključnom markeru oštećenja jetre, ove vrednosti najverovatnije predstavljaju realna patološka stanja kod pacijenata sa oštećenjem jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona AST**

```{r}
summary(dataset$AST)
```

Vrednosti parametra AST su u rasponu od 10.60 do 324.00.
Srednja vrednost iznosi 34.79, dok je medijana 25.90.
Znatna razlika između srednje vrednosti i medijane ukazuje na to da je raspodela izrazito asimetrična udesno.

Grafički prikaz raspodele pacijenata u odnosu na AST

```{r}
ggplot(dataset, aes(x = AST)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele AST")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednost AST u opsegu između 20 i 40.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje prisustvo brojnih outlajera koji prelaze vrednost od 100, dok ekstremni slučajevi dostižu i preko 300.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$AST, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$AST, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$AST[dataset$AST < donja_granica | dataset$AST > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu AST, donji kvartil iznosi 4.65, a gornji kvartil 49.85.
Primenom IQR metode identifikovano je ukupno 64 outlajera, što ukazuje na postojanje vrednosti koje odstupaju od većine podataka.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$AST, main = "Boxplot za AST", horizontal = TRUE)
```

I boxplot za kolonu AST vizuelno potvrđuje prisustvo Velikog broja gornjih outlajera, koji ukazuju na izraženu desnu asimetriju.
S obzirom da je AST važan biohemijski marker oštećenja jetre, ove povišene vrednosti predstavljaju realna patološka stanja kod pacijenata sa oštećenjem jetre.
Zbog toga outlajeri neće biti uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona BIL**

```{r}
summary(dataset$BIL)
```

Vrednosti parametra BIL su u rasponu od 0.8 do 254.00.
Srednja vrednost iznosi 11.4, dok je medijana 7.3, što ukazuje na to da je raspodela asimetrična udesno, jer je srednja vrednost veća od medijane.

Grafički prikaz raspodele pacijenata u odnosu na BIL

```{r}
ggplot(dataset, aes(x = BIL)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele BIL")
```

Na osnovu dijagama vidimo da najveći broj pacijenata ima niske vrednosti BIL, u opsegu između 5 i 15.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo outlajera.
Manji broj pacijenata ima veoma povišene vrednosti bilirubina koje prelaze 100, dok ekstremni slučajevi dostižu i preko 200, što je tipično za teška oštećenja funkcije jetre.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$BIL, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$BIL, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$BIL[dataset$BIL < donja_granica | dataset$BIL > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu BIL, donji kvartil iznosi -3.55, a gornji 20.05.
Primenom IQR metode identifikovano je ukupno 47 outlajera.
Ova visoka broj outlajera ukazuje na značajne varijacije u nivoima bilirubina kod pacijenata.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$BIL, main = "Boxplot za BIL", horizontal = TRUE)
```

Boxplot za kolonu BIL ukazuje na desno asimetričnu raspodelu sa značajnim brojem gornjih outlajera.
Ovo potvrđuje prisustvo pacijenata sa značajno povišenim nivoima bilirubina. S obzirom da je bilirubin ključni indikator jetrenih funkcija, ova odstupanja od normalnih vrednosti mogu biti posledica različitih oboljenja jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CHE**

```{r}
summary(dataset$CHE)
```

Vrednosti parametra CHE su u rasponu od 1.420 do 16.410.
Srednja vrednost iznosi 8.197, dok je medijana 8.260, što ukazuje da je raspodela približno simetrična, bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na CHE

```{r}
ggplot(dataset, aes(x = CHE)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CHE")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti CHE u opsegu između 6 i 10.
Možemo uočiti i potencijalne outlajere na nižim i višim vrednostima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CHE, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CHE, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CHE[dataset$CHE < donja_granica | dataset$CHE > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CHE, donji kvartil iznosi 2.95, dok gornji kvartil iznosi 13.57.
Primenom IQR metode identifikovana su ukupno 24 outliera, što ukazuje na prisustvo značajne varijabilnosti u nivoima holinesteraze među pacijentima.
S obzirom na to da je holinesteraza važan biohemijski marker funkcije jetre, odstupanja od normalnih vrednosti mogu biti posledica različitih oboljenja jetre.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CHE, main = "Boxplot za CHE", horizontal = TRUE)
```

Boxplot za kolonu CHE ukazuje na raspodelu sa izraženim outlierima na obe strane, što potvrđuje prisustvo pacijenata sa ekstremno sniženim i ekstremno povišenim vrednostima ovog enzima, što može biti posledica različitih oboljenja jetre i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CHOL**

```{r}
summary(dataset$CHOL)
```

Vrednosti parametra CHOL su u rasponu od 1.430 do 9.670.
Srednja vrednost iznosi 5.367, dok je medijana 5.300, što ukazuje da je raspodela približno simetrična, bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na CHOL

```{r}
ggplot(dataset, aes(x = CHOL)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CHOL")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti CHE u opsegu otprilike između 4,5 i 6.
Možemo uočiti i potencijalne outlajere na nižim i višim vrednostima.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CHOL, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CHOL, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CHOL[dataset$CHOL < donja_granica | dataset$CHOL > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CHOL, donji kvartil iznosi 2.46, dok gornji kvartil iznosi 8.21. Primenom IQR metode identifikovana su ukupno 12 outliera, što ukazuje na prisustvo varijabilnosti u nivoima holesterola među pacijentima.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CHOL, main = "Boxplot za CHOL", horizontal = TRUE)
```

Boxplot za kolonu CHOL ukazuje na raspodelu sa izraženim outlierima na obe strane, što potvrđuje prisustvo pacijenata sa ekstremno sniženim i ekstremno povišenim vrednostima holesterola. S obzirom na to da je holesterol bitan medicinski podatak koji zavisi od ishrane, genetike i opšteg zdravlja, ovakva odstupanja su sasvim normalna, izbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona CREA**

```{r}
summary(dataset$CREA)
```

Vrednosti parametra CREA su u rasponu od 8.00 do 1079.10.
Srednja vrednost iznosi 81.29, dok je medijana 77.00, što ukazuje na asimetričnu raspodelu udesno, jer je srednja vrednost veća od medijane.

Grafički prikaz raspodele pacijenata u odnosu na CREA

```{r}
ggplot(dataset, aes(x = CREA)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele CREA")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti kreatinina u opsegu otprilike između 60 i 100.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo izraženih outliera.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$CREA, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$CREA, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$CREA[dataset$CREA < donja_granica | dataset$CREA > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu CREA, donji kvartil (Q1) iznosi 35.5, a gornji (Q3) 119.5.
Primenom IQR metode identifikovano je ukupno 12 outlajera.
Prisutne su vrednosti koje drastično odskaču od proseka (poput 519.0 i 1079.1), što ukazuje na pacijente sa ozbiljno narušenom funkcijom bubreg. Ovo je važno jer ozbiljna oboljenja jetre često dovode i do prestanka rada bubrega.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$CREA, main = "Boxplot za CREA", horizontal = TRUE)
```

Boxplot za kolonu CREA ukazuje na desno asimetričnu raspodelu sa izraženim gornjim outlajerima.
Vizuelni prikaz potvrđuje da se većina vrednosti nalazi u nižem opsegu, dok mali broj ekstremno visokih vrednosti značajno odstupa. Zbog prethodno navedenih razloga outlajeri neće biti uklonjeni iz dalje analize, kako bi se zadržala potpuna informacija o varijabilnosti podataka.

**Kolona GGT**

```{r}
summary(dataset$GGT)
```

Vrednosti parametra GGT su u rasponu od 4.50 do 650.90.
Srednja vrednost iznosi 39.53, dok je medijana 23.30, što ukazuje na izraženu desnu asimetriju raspodele.
Većina pacijenata ima niske vrednosti GGT, koncentrisane u donjem delu raspodele, dok manji broj pacijenata ima veoma visoke vrednosti, koje značajno utiču na povećanje srednje vrednosti.

Grafički prikaz raspodele pacijenata u odnosu na GGT

```{r}
ggplot(dataset, aes(x = GGT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele GGT")
```

Na osnovu grafika vidimo da je najveći broj pacijenata ima niže vrednosti GGT.
Raspodela ima izražen rep ka višim vrednostima, što ukazuje na prisustvo izraženih outliera.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$GGT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$GGT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$GGT[dataset$GGT < donja_granica | dataset$GGT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu GGT, donji kvartil iznosi -21.05, a gornji 76.95.
Primenom IQR metode identifikovano je ukupno 65 outlajera.
Ovako veliki broj ekstremnih vrednosti ukazuje na značajne varijacije u nivoima ovog enzima među pacijentima.
Budući da je GGT osetljiv pokazatelj oštećenja jetre i žučnih puteva, ove visoke vrednosti (koje dosežu i do 650.9) klinički su veoma značajne jer ukazuju na ozbiljne zdravstvene probleme..

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$GGT, main = "Boxplot za GGT", horizontal = TRUE)
```

Boxplot za kolonu GGT ukazuje na izrazito desno asimetričnu raspodelu sa velikim brojem gornjih outlajera.
Ovakav grafički prikaz potvrđuje prisustvo grupe pacijenata sa drastično povišenim nivoima enzima, što je od ključnog značaja za dijagnostiku oštećenja jetre i problema sa žučnim putevima, i zbog toga outlajeri neće biti uklonjeni iz dalje analize.

**Kolona PROT**

```{r}
summary(dataset$PROT)
```

Vrednosti parametra PROT su u rasponu od 44.80 do 90.00.
Srednja vrednost iznosi 72.04, dok je medijana 72.20, što ukazuje na približno simetričnu raspodelu bez izražene asimetrije.

Grafički prikaz raspodele pacijenata u odnosu na PROT

```{r}
ggplot(dataset, aes(x = PROT)) +
  geom_histogram(bins = 30) +
  labs(title = "Histogram raspodele PROT")
```

Na osnovu grafika vidimo da najveći broj pacijenata ima vrednosti PROT u opsegu između približno 65 i 80.
Raspodela je relativno simetrična, uz prisustvo manjeg broja nižih i viših vrednosti.

Proverićemo outliere za ovu numeričku kolonu

```{r}

#Izračunavanje kvartila

Q1 <- quantile(dataset$PROT, 0.25, na.rm = TRUE)
Q3 <- quantile(dataset$PROT, 0.75, na.rm = TRUE)
IQR_val <- Q3 - Q1

#Određivanje granica za outlajere

donja_granica <- Q1 - 1.5 * IQR_val
gornja_granica <- Q3 + 1.5 * IQR_val

#Prikaz donje i gornje granice

donja_granica
gornja_granica

#Pronalaženje outlajera

outliers <- dataset$PROT[dataset$PROT < donja_granica | dataset$PROT > gornja_granica]

#Broj outlajera

length(outliers)
outliers

```

Za kolonu PROT, donji kvartil iznosi 60.15, dok je gornji 84.55.
Primenom IQR metode, identifikovano je 20 outlajera.
Primećujemo značajan broj outlajera koji su ispod proseka (npr. 44.8, 47.0).
Kako je jetra odgovorna za stvaranje skoro svih proteina u našoj krvi, ovi niski rezultati su direktan pokazatelj da jetra kod tih pacijenata verovatno ne funkcioniše kako treba i da ne može da proizvede dovoljno proteina.

Boxplot za vizuelnu detekciju outlajera

```{r}

boxplot(dataset$PROT, main = "Boxplot za PROT", horizontal = TRUE)
```

Boxplot za kolonu PROT ukazuje na prisustvo outlajera na oba kraja distribucije, što ukazuje na pacijente sa vrednostima koje značajno odstupaju od proseka.
Ovakav grafički prikaz potvrđuje postojanje grupe pacijenata sa smanjenom koncentracijom proteina, što je od ključnog značaja za dijagnostiku poremećaja u ishrani, kao i potencijalnih problema sa radom jetre, i zbog toga outlajere nećemo ukloniti iz dalje analize.

**Kolona Category - izlazna kolona**

Pošto je Category kategorijska kolona prikazaćemo tabelu učestalosti da bismo videli koliko puta se svaka kategorija pojavljuje.

```{r}
table(dataset$Category)
```

Izlazna kolona Category predstavlja zdravstveni status pacijenta i sadrži pet klasa: 0 – Blood Donor, 0s – Suspect Blood Donor, 1 – Hepatitis, 2 – Fibrosis i 3 – Cirrhosis.

Grafički prikaz raspodele kategorija

```{r}
ggplot(dataset, aes(x = Category)) +
  geom_bar() +
  labs(title = "Raspodela kategorija zdravstvenog statusa pacijenata u datasetu")
```

## Logička i bivarijantna analiza podataka

Nakon uradjene univarijantne analize, kojom smo prikazali ekstremne vrednosti u okviru pojedinačnih laboratorijskih parametara, uradićemo i logičku analizu odnosa između različitih parametara. Dok univarijantni pristup detektuje vrednosti koje odstupaju od proseka, bivarijantna i multivarijantna analiza omogućavaju uočavanje onih podataka koji su unutar "normalnih" granica kada se posmatraju izolovano, ali formiraju medicinski nemoguće ili sumnjive kombinacije.

**Provera odnosa ALB i PROT**

Prvo ćemo proveriti odnos izmedju albumina(ALB), najzastupljenijeg proteina u krvi, i ukupnih proteina(PROT). Kako je albumin samo jedan od proteina njegova vrednost ne može prelaziti vrednost ukupnih proteina.

Ovim kodom izolujemo redove gde je albumin veći od ukupnih proteina, što je logička greška.

```{r}
greske_alb_prot <- dataset[which(dataset$ALB > dataset$PROT), ]
nrow(greske_alb_prot)
```
```{r}
greske_alb_prot
```

Vidimo da takvih redova ima samo jedan.
Sledećim grafikom ćemo vizuelno prikazati red u kom se nalazi pacijent kojem je albumin veći od ukupnih proteina.

```{r}
ggplot(dataset, aes(x = PROT, y = ALB)) +
  geom_point(alpha = 0.5) +
  geom_abline(color = "red") 
```

Obrisaćemo red koji krši logičko pravilo.
```{r}
dataset <- dataset[dataset$X != 217, ]

nrow(dataset[dataset$X == 217, ])
```

**Validacija zdravih donora (Category 0)**

Kategorija "Blood Donor" predstavlja zdrave pacijente. Iako su u medicini odstupanja moguća, ekstremno visoke vrednosti enzima jetre kod zdravih pacijenata narušavaju definiciju kategorije. Ukoliko pacijent označen kao "Blood Donor" ima vrednosti AST ili ALT koje su višestruko iznad gornje granice normale (npr.> 200 U/L), taj red se smatra nereprezentativnim za ciljnu kategoriju.

```{r}
sumnjivi_donori <- dataset[which(dataset$Category == "0=Blood Donor" & (dataset$AST > 200 | dataset$ALT > 200)), ]

sumnjivi_donori
```
Vidimo da u kategoriji "Blood Donor" nema pacijenata sa ekstremno povišenim vrednostima AST i ALT enzima(iznad 200 U/L).

**Konzistentnost holinesteraze (CHE) kod ciroze**

Holinesteraza(CHE) je jedan od najpouzdanijih pokazatelja sposobnosti jetre da proizvodi proteine. Kod pacijenata koji imaju cirozu, nivo holinesteraze je po pravilu veoma nizak. Ukoliko pacijent označen kao "Cirrhosis" ima visoke vrednosti CHE(npr.> 10 kU/L), taj red se smatra nereprezentativnim za ciljnu kategoriju, jer protivreči patofiziološkom stanju ciroze.

```{r}
sumnjiva_ciroza <- dataset[which(dataset$Category == "3=Cirrhosis" & dataset$CHE > 10), ]

sumnjiva_ciroza
```
Vidimo da u kategoriji "Cirrhosis" nema pacijenata sa visokim vrednostima CHE (iznad 10 kU/L).


# Analiza podataka

## Analiza izmedju prediktora i odgovora

ALT, AST i GGT ćemo analizirati na početku jer su to osnovni i najosetljiviji enzimi koji direktno ukazuju na oštećenje jetre i omogućavaju jasno razlikovanje zdravih pacijenata od onih sa oboljenjima jetre.

## Kolona ALT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ALT enzima.

```{r}
ggplot(data = dataset, aes(x = Category, y = ALT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALT vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALT"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da pacijenti sa oboljenjima jetre (hepatitis, fibroza i ciroza) uglavnom imaju više vrednosti ALT enzima u odnosu na zdrave i sumnjive davaoce krvi.
Posebno se izdvajaju pacijenti sa hepatitisom i fibrozom, kod kojih su ALT vrednosti više i znatno promenljivije, što ukazuje na izraženije oštećenje jetre.
Kod pacijenata sa cirozom primećuju se pojedinačne veoma visoke vrednosti ALT enzima, ali je medijana niža u poređenju sa fibrozom, što može biti posledica smanjene funkcije jetre u kasnijim fazama bolesti.
Na osnovu ovoga može se zaključiti da je ALT dobar pokazatelj i da može imati značajnu ulogu za nas model predikcije.

## Kolona AST

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti AST enzima.

```{r}
ggplot(data = dataset, aes(x = Category, y = AST)) +
  geom_boxplot() +
  labs(
    title = "Distribucija AST vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "AST"
  ) +
 theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da pacijenti sa oboljenjima jetre imaju više vrednosti AST enzima u poređenju sa zdravim i sumnjivim davaocima krvi.
Vrednosti AST enzima rastu sa težinom oboljenja, pri čemu su najviše mediane prisutne kod pacijenata sa fibrozom i cirozom.
Kod pacijenata sa hepatitisom primećena je veća varijabilnost AST vrednosti, uz prisustvo pojedinačnih visokih ekstremnih vrednosti.
Davaoci krvi imaju najniže i najstabilnije vrednosti AST enzima, što ukazuje na normalnu funkciju jetre.
Na osnovu ovih rezultata može se zaključiti da AST, slično kao ALT, predstavlja dobar pokazatelj oštećenja jetre i može imati značajnu ulogu u modelu predikcije.

## Kolona GGT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti GGT enzima.

```{r}
ggplot(data = dataset, aes(x = Category, y = GGT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija GGT vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "GGT"
  ) +
 theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Grafik pokazuje da GGT enzimi rastu kako bolest jetre napreduje.
Zdrave osobe imaju najniže vrednosti, a kod pacijenata sa cirozom su najveće i dosta razbacane.
Kod hepatitisa se vidi veliki skok u odnosu na prethodne grupe, što može značiti različite faze bolesti ili neke druge komplikacije.
Zaključak, GGT je isto dobar pokazatelj za model predikcije.

Nakon analize AST, ALT i GGT, fokus se premešta na ALB, koji predstavlja pokazatelj sintetičke funkcije jetre i omogućava procenu ozbiljnosti oštećenja jetre kod pacijenata sa Hepatitisom C.

## Kolona ALB

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti albumina (ALB).

```{r}
ggplot(data = dataset, aes(x = Category, y = ALB)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALB vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALB"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Grafik pokazuje da nivo albumina (ALB) opada kako bolest jetre napreduje, ali ima dosta varijacije među pacijentima u svakoj kategoriji i treba uzeti u obzir druge faktore koji mogu uticati na ALB vrednosti.
Možemo uzeti ALB kao dodatni pokazatelj na krajnji model predikcije.

## Kolona BIL

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti BIL.

```{r}
ggplot(data = dataset, aes(x = Category, y = BIL)) +
  geom_boxplot() +
  labs(
    title = "Distribucija BIL vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "BIL"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Grafički prikaz pokazuje da se nivo bilirubina (BIL) postepeno povećava sa napredovanjem bolesti jetre, od zdravih ispitanika ka pacijentima sa cirozom, što je u skladu sa očekivanim pogoršanjem funkcije jetre.
Takođe, uočava se prisustvo većeg broja ekstremnih vrednosti, naročito u grupi pacijenata sa cirozom, što ukazuje na izraženu varijabilnost unutar ove kategorije i postojanje pojedinaca sa znatno povišenim koncentracijama bilirubina u poređenju sa ostalim pacijentima iste grupe.
Zaključak je da možemo isto uzeti BIL kao što smo uradili sa ALB kao pomoćni indikator za predikciju.

## Kolona ALP

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ALP enzima.

```{r}
ggplot(data = dataset, aes(x = Category, y = ALP)) +
  geom_boxplot() +
  labs(
    title = "Distribucija ALP vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "ALP"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da postoje razlike u vrednostima ALP između različitih kategorija pacijenata.
Sumnjivi davaoci krvi (0s) imaju najviše mediane i veće rasipanje vrednosti, dok zdravi davaoci (0) imaju niže i stabilnije vrednosti ALP.
Kod pacijenata sa hepatitisom (1) i fibrozom (2) mediane su niže, dok kod pacijenata sa cirozom (3) dolazi do ponovnog porasta vrednosti ALP uz prisustvo ekstremno visokih vrednosti.

Ovakav obrazac ukazuje da se ALP menja u zavisnosti od stadijuma bolesti i da može imati značajnu ulogu u razlikovanju pacijenata sa uznapredovalim oboljenjem jetre.

## Kolona CHE

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti CHE enzima.

```{r}
ggplot(data = dataset, aes(x = Category, y = CHE)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CHE vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CHE"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da postoje izražene razlike u vrednostima CHE između kategorija pacijenata.
Pacijenti sa cirozom (3) imaju znatno niže vrednosti CHE u poređenju sa svim ostalim grupama, što ukazuje na ozbiljno smanjenu sintetičku funkciju jetre.
Sumnjivi davaoci krvi (0s) takođe imaju niže mediane u odnosu na zdrave davaoce, dok pacijenti sa hepatitisom (1) i fibrozom (2) imaju vrednosti slične zdravima.

Ovakav obrazac potvrđuje da je CHE snažan pokazatelj funkcionalnog stanja jetre i da ima važnu ulogu u razlikovanju uznapredovalih stadijuma bolesti u modelu predikcije.

## Kolona CHOL

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti holesterola (CHOL).

```{r}
ggplot(data = dataset, aes(x = Category, y = CHOL)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CHOL vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CHOL"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da postoje razlike u vrednostima holesterola (CHOL) između kategorija pacijenata.
Pacijenti sa cirozom jetre (3) imaju najniže vrednosti CHOL u poređenju sa ostalim grupama, što ukazuje na poremećaj metabolizma lipida usled smanjene funkcije jetre.
Zdravi i sumnjivi davaoci krvi, kao i pacijenti sa hepatitisom (1) i fibrozom (2), imaju više i međusobno sličnije vrednosti holesterola.

Ovakav obrazac potvrđuje da je CHOL značajan pokazatelj funkcionalnog stanja jetre i koristan prediktor u razlikovanju uznapredovalih stadijuma bolesti u modelu predikcije.

## Kolona CREA

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti kreatinina (CREA).

```{r}
ggplot(data = dataset, aes(x = Category, y = CREA)) +
  geom_boxplot() +
  labs(
    title = "Distribucija CREA vrednosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "CREA"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da vrednosti kreatinina (CREA) variraju između kategorija pacijenata.
Pacijenti sa cirozom jetre (3) pokazuju najviše vrednosti CREA, uz prisustvo izraženih ekstremnih vrednosti, što može ukazivati na dodatno opterećenje bubrežne funkcije kod uznapredovalog stadijuma bolesti.
Ostale grupe, uključujući zdrave i sumnjive davaoce krvi, kao i pacijente sa hepatitisom (1) i fibrozom (2), imaju niže i međusobno slične vrednosti kreatinina.

Ovakav obrazac ukazuje da CREA može imati značajnu ulogu u razlikovanju pacijenata sa cirozom od ostalih kategorija u modelu predikcije.

## Kolona PROT

Grafikom ispod prikazan je odnos između kategorije pacijenata i vrednosti ukupnih proteina (PROT).

```{r}
ggplot(data = dataset, aes(x = Category, y = PROT)) +
  geom_boxplot() +
  labs(
    title = "Distribucija vrednosti proteina po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "PROT"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da postoje razlike u vrednostima ukupnih proteina (PROT) između kategorija pacijenata. Sumnjivi davaoci krvi (0s) imaju znatno niže vrednosti PROT u poređenju sa ostalim grupama, dok pacijenti sa cirozom jetre (3) takođe pokazuju blago snižene vrednosti. Zdravi davaoci krvi, kao i pacijenti sa hepatitisom (1) i fibrozom (2), imaju međusobno slične i više vrednosti ukupnih proteina.

Ovakav obrazac ukazuje da PROT može imati umerenu prediktivnu vrednost, naročito u razlikovanju sumnjivih davalaca i pacijenata sa uznapredovalim oštećenjem jetre u modelu predikcije.

## Kolona Age

Grafikom ispod prikazan je odnos između kategorije pacijenata i starosti.

```{r}
ggplot(data = dataset, aes(x = Category, y = Age)) +
  geom_boxplot() +
  labs(
    title = "Distribucija starosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "Age"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Na osnovu prikazanog grafikona može se uočiti da se starost pacijenata razlikuje između kategorija.
Pacijenti sa hepatitisom (1) u proseku su mlađi u poređenju sa ostalim grupama, dok sumnjivi davaoci krvi (0s), kao i pacijenti sa fibrozom (2) i cirozom (3), imaju više mediane vrednosti starosti.
Zdravi davaoci krvi (0) nalaze se između ove dve grupe po vrednostima starosti.

Ovakav obrazac ukazuje da starost može imati ulogu u razlikovanju pojedinih kategorija pacijenata, ali sa manjim diskriminativnim značajem u poređenju sa biohemijskim parametrima u modelu predikcije.

## Kolona Sex

Grafikom ispod prikazan je odnos između kategorije pacijenata i polova.

```{r}
ggplot(data = dataset, aes(x = Category, fill = Sex)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Distribucija pola po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "Broj pacijenata",
    fill = "Pol"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Na osnovu prikazanog grafikona može se uočiti da je u svim kategorijama pacijenata zastupljen veći broj muškaraca u odnosu na žene, pri čemu je ova razlika najizraženija u grupi zdravih davalaca krvi (0). Iako su razlike u polnoj strukturi vidljive, ne uočava se jasan obrazac koji bi omogućio pouzdano razdvajanje kategorija pacijenata isključivo na osnovu pola.

Ovakav nalaz ukazuje da pol (Sex) ima ograničenu prediktivnu vrednost kao samostalan parametar, ali može doprineti modelu predikcije u kombinaciji sa ostalim kliničkim i biohemijskim prediktorima.


```{r}
ggplot(dataset, aes(x = Category, y = Age)) +
  geom_boxplot() +
  labs(
    title = "Distribucija starosti po kategorijama pacijenata",
    x = "Kategorija pacijenata",
    y = "Starost"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
ggplot(dataset, aes(x = Category, fill = Sex)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Raspodela zdravstvenog statusa u odnosu na pol",
    x = "Zdravstveni status",
    y = "Broj pacijenata"
  )
```

```{r}
ggplot(dataset, aes(x = ALB, y = PROT, color = Category)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Odnos između albumina i ukupnih proteina",
    x = "ALB",
    y = "PROT"
  )

```


## Odnos ALT i AST po kategorijama pacijenata

```{r}
ggplot(dataset, aes(x = ALT, y = AST, color = Category)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Odnos ALT i AST po kategorijama pacijenata",
    x = "ALT",
    y = "AST"
  )
```

Na scatter plot-u se vidi da sa porastom ALT vrednosti raste i AST, a pacijenti sa hepatitisom, fibrozom i cirozom imaju znatno više vrednosti nego zdravi donori krvi, dok su vrednosti kod donora niske i koncentrisane.
Zajedno ova dva enzima bi mogli da daju jasniji model predikcije.

# Zaključak na osnovu celokupne analize

Na osnovu sprovedene analize može se zaključiti da zdravstveni status pacijenata snažno zavisi od više biohemijskih parametara krvi, među kojima se posebno izdvajaju ALT, AST i GGT kao najvažniji pokazatelji oštećenja jetre.
Ovi enzimi jasno razdvajaju zdrave i sumnjive davaoce krvi od pacijenata sa hepatitisom, fibrozom i cirozom, naročito kada se posmatraju u međusobnoj kombinaciji.
Pored njih, parametri sintetičke funkcije jetre kao što su CHE, ALB i CHOL imaju značajnu ulogu u prepoznavanju uznapredovalih stadijuma bolesti, dok BIL i CREA dodatno ukazuju na težinu oboljenja kod pacijenata sa cirozom.
Demografske promenljive, poput starosti i pola, pokazuju slabiji uticaj u poređenju sa biohemijskim pokazateljima.
Na osnovu kombinacije domenskog znanja i analize grafičkih prikaza, može se zaključiti da je opravdano razviti model predikcije koji će se prvenstveno oslanjati na biohemijske parametre.
U nastavku rada biće ispitano koliko dobar prediktivni model može da se izgradi na osnovu ovih promenljivih.

# Korelaciona matrica

```{r}
cor_matrix <- cor(select_if(dataset, is.numeric))
cor_matrix

```

Korelaciona matrica omogućava prikaz povezanosti između numeričkih kolona.
Na osnovu matrice može se uočiti da ALB i PROT imaju umerenu pozitivnu korelaciju od oko 0.55, što ukazuje da se povećanje vrednosti jedne varijable uglavnom prati povećanjem druge.
Većina ostalih varijabli ima korelaciju ispod 0.35, što pokazuje slabu linearnu povezanost među njima, dok je Age umereno povezani sa korelacijom od 0.42.
Iako ne postoji izražena multikolinearnost, umerene korelacije kod pojedinih atributa mogu uticati na ponašanje linearnih modela, pa je to potrebno imati u vidu prilikom njihove primene.

## Kreiranje modela 

Prvo pripremam podatke tako što kategorijske promenljive pretvaram u factor.

```{r}
dataset$Category = factor(dataset$Category)
dataset$Sex = factor(dataset$Sex)
```

Podela podataka na train:test skup u odnosu 80:20.
Stratifikacija na osnovu kolone Category.

```{r}
set.seed(123)
trainIndex <- createDataPartition(dataset$Category, p = 0.8, list = FALSE)

train <- dataset[trainIndex, ]
test <- dataset[-trainIndex, ]
```

# Decision tree

```{r}
library(rpart)
library(rpart.plot)  # za lepši prikaz stabla

# Početni decision tree
tree_model1 <- rpart(Category ~ ALT + AST + GGT + ALB + BIL,
                     method = "class",
                     data = train)

summary(tree_model1)

```

Na osnovu dobijenog izlaza može se primetiti da se u pojedinim terminalnim čvorovima nalazi veći broj posmatranja iz različitih kategorija bolesti jetre. To ukazuje da model nema jasnu granicu razdvajanja između pojedinih klasa.

Na primer, u čvoru 13 nalazi se ukupno 24 posmatranja, pri čemu su istovremeno prisutne kategorije Hepatitis, Fibrosis i Cirrhosis. Iako je predikovana klasa Fibrosis, raspodela verovatnoća pokazuje značajno preklapanje između klasa, što znači da model teško razlikuje ove faze bolesti.

Slično se primećuje i u čvorovima 26 i 27, gde se Fibrosis i Cirrhosis često javljaju zajedno, uz slične vrednosti parametara GGT, ALB, ALT i AST. Ovi rezultati ukazuju da je klasifikacija sa pet kategorija previše složena za dati skup obeležja i može dovesti do slabijih i nestabilnijih rezultata.

#Razlog za spajanje kategorija

Na osnovu dobijenih rezultata zaključeno je da je opravdano smanjiti broj kategorija ciljne promenljive. Cilj ove analize nije detaljno razlikovanje svih stadijuma bolesti jetre, već da se na pouzdan način razdvoje zdrave osobe od osoba kod kojih je prisutno oboljenje jetre.

Zbog toga su kategorije spojene na sledeći način:

0 – Blood Donor i Suspect Blood Donor

1 – Hepatitis, Fibrosis i Cirrhosis

Na ovaj način problem se svodi na binarni klasifikacioni zadatak, koji je jednostavniji za modelovanje i lakši za tumačenje rezultata. I dalje se radi o klasifikaciji, a ne o regresiji, jer ciljna promenljiva ostaje kategorijska, samo sa manjim brojem klasa.

#Spajanje kategorija i novi decision tree model
```{r}
# Kreiranje binarne ciljne promenljive (ISPRAVNO)
dataset$Category_bin <- ifelse(dataset$Category %in% 
                                 c("0=Blood Donor", "0s=suspect Blood Donor"),
                               0, 1)

# Pretvaranje u faktor
dataset$Category_bin <- factor(dataset$Category_bin,
                               levels = c(0, 1),
                               labels = c("No_disease", "Liver_disease"))

# Podela na train i test skup
set.seed(123)
trainIndex_bin <- createDataPartition(dataset$Category_bin,
                                      p = 0.8,
                                      list = FALSE)

train_bin <- dataset[trainIndex_bin, ]
test_bin  <- dataset[-trainIndex_bin, ]
```

```{r}
# Decision tree sa binarnom klasifikacijom
tree_model_bin <- rpart(Category_bin ~ ALT + AST + GGT + ALB + BIL,
                        method = "class",
                        data = train_bin)

summary(tree_model_bin)

rpart.plot(tree_model_bin,
           main = "Decision tree – binarna klasifikacija",
           extra = 104)z
```
Na osnovu rezultata decision tree modela sa binarnom ciljnom promenljivom može se uočiti da model ostvaruje jasno razdvajanje između zdravih osoba i osoba sa oboljenjem jetre.

U čvoru 2, koji obuhvata čak 447 posmatranja (više od 90% trening skupa), dominantna je klasa No_disease, sa verovatnoćom od 95.3%. Očekivani gubitak u ovom čvoru je veoma nizak, što ukazuje da model sa velikom sigurnošću prepoznaje zdrave osobe.

Sa druge strane, čvor 3 obuhvata 45 posmatranja i dominantno sadrži klasu Liver_disease, sa verovatnoćom od 86.7%. Ovo pokazuje da model uspeva da identifikuje osobe kod kojih postoji oboljenje jetre, uz relativno mali broj pogrešnih klasifikacija.

Dodatno, u terminalnim čvorovima 4 i 5 primećuje se još jasnija separacija klasa, pri čemu su verovatnoće pravilne klasifikacije veoma visoke. Za razliku od početnog modela sa pet kategorija, ovde nema izraženog preklapanja klasa, a struktura stabla je jednostavnija i lakša za interpretaciju.

## Logistička regresija

```{r}
# Kopija podataka
dataset_log <- dataset

# Standardizacija numeričkih kolona
num_cols <- sapply(dataset_log, is.numeric)
dataset_log[num_cols] <- scale(dataset_log[num_cols])

set.seed(123)
trainIndex_log <- createDataPartition(dataset_log$Category_bin,
                                      p = 0.8,
                                      list = FALSE)

train_log <- dataset_log[trainIndex_log, ]
test_log  <- dataset_log[-trainIndex_log, ]
```

Napravljena je kopija podataka kako bi originalni skup ostao neizmenjen, dok su numerički atributi skalirani jer logistička regresija zavisi od skale podataka i može dati nepouzdane rezultate ako se koriste neujednačene vrednosti.

```{r}
log_model <- glm(Category_bin ~ ALT + AST + GGT + ALB + BIL,
                 data = train_log,
                 family = binomial)

summary(log_model)
```
Značajno smanjenje devijanse u odnosu na nul-model ukazuje da uključeni prediktori imaju važan doprinos u objašnjenju ciljne promenljive.
Rezultati logističke regresije pokazuju da su AST, GGT i BIL statistički značajni prediktori pojave oboljenja jetre, dok ALT ima negativan uticaj na verovatnoću pripadnosti klasi obolelih. Sa druge strane, ALB se ne pokazuje kao značajan prediktor u okviru ovog modela (p > 0.05).

#Predikcija - Logistička regresija
```{r}
# Predikcija verovatnoća
log_pred_prob <- predict(log_model,
                         newdata = test_log,
                         type = "response")

# Binarna odluka (0.5 prag)
log_pred <- ifelse(log_pred_prob > 0.5,
                   "Liver_disease",
                   "No_disease")

# Confusion matrix
confusionMatrix(
  factor(log_pred,
         levels = c("No_disease", "Liver_disease")),
  test_log$Category_bin
)
```

Na test skupu logistička regresija postiže visoku tačnost, međutim zbog neravnoteže klasa veći značaj imaju mere osetljivosti i specifičnosti. Model pokazuje veoma visoku osetljivost za klasu zdravih pacijenata (Sensitivity = 0.97), dok je specifičnost niža (0.73), što ukazuje da se deo obolelih pacijenata pogrešno klasifikuje kao zdravi. Balanced accuracy i Kappa koeficijent potvrđuju da model ima dobru ukupnu pouzdanost, ali sa izraženim ograničenjima u detekciji obolelih.

#Predikcija - Decision Tree
```{r}
# Predikcija klasa na test skupu
tree_pred <- predict(tree_model_bin,
                     newdata = test_bin,
                     type = "class")

# Confusion matrix
confusionMatrix(
  factor(tree_pred,
         levels = c("No_disease", "Liver_disease")),
  test_bin$Category_bin
)

```
Na test skupu decision tree model ostvaruje visoku tačnost klasifikacije (Accuracy ≈ 94%), što ukazuje da model u velikom broju slučajeva pravilno razdvaja zdrave ispitanike od onih sa oboljenjem jetre. S obzirom na neravnotežu klasa u podacima, veći značaj imaju mere osetljivosti i specifičnosti. Model pokazuje veoma visoku osetljivost za klasu zdravih pacijenata (Sensitivity ≈ 0.95), dok je specifičnost takođe relativno visoka (Specificity ≈ 0.87), što znači da decision tree uspešno prepoznaje i značajan deo obolelih pacijenata.Balanced accuracy i Kappa koeficijent potvrđuju da model ima dobru ukupnu pouzdanost. Na osnovu strukture stabla može se videti da je AST najvažniji parametar u razdvajanju klasa, dok ostali biohemijski pokazatelji imaju dopunsku ulogu u donošenju odluke.

```{r}
# Logistic regression ROC
roc_lr <- roc(
  test_log$Category_bin,
  log_pred_prob,
  levels = c("No_disease", "Liver_disease"),
  direction = "<"
)

# Decision tree ROC
tree_prob <- predict(tree_model_bin, test_bin, type = "prob")[, "Liver_disease"]

roc_dt <- roc(
  test_bin$Category_bin,
  tree_prob,
  levels = c("No_disease", "Liver_disease"),
  direction = "<"
)

# Plot
plot(roc_lr, col = "blue", lwd = 2, main = "ROC upoređivanje")
lines(roc_dt, col = "red", lwd = 2)
legend("bottomright",
       legend = c(
         paste("Logistička regresija (AUC =", round(auc(roc_lr), 3), ")"),
         paste("Decision Tree (AUC =", round(auc(roc_dt), 3), ")")
       ),
       col = c("blue", "red"),
       lwd = 2)

```

Na osnovu ROC krivih može se uočiti da oba modela ostvaruju veoma dobre performanse klasifikacije, jer se njihove krive nalaze znatno iznad dijagonale koja predstavlja slučajnu klasifikaciju. Logistička regresija ima veću AUC vrednost (AUC = 0.964) u poređenju sa decision tree modelom (AUC = 0.921), što ukazuje da logistička regresija u proseku bolje rangira posmatranja po verovatnoći pripadnosti klasi obolelih, nezavisno od izabranog praga.

Međutim, iako logistička regresija ima višu ukupnu diskriminativnu moć, decision tree model pokazuje konkurentne performanse i ostvaruje dobar balans između osetljivosti i specifičnosti u relevantnom delu ROC prostora. Razlika između krivih je relativno mala, što sugeriše da oba modela pružaju pouzdane predikcije, ali sa različitim prednostima u zavisnosti od kriterijuma evaluacije.